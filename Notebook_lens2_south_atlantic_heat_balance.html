

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>CESM2 - LARGE ENSEMBLE (LENS2) &#8212; Analysis Project Template</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Notebook_lens2_south_atlantic_heat_balance';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="CESM2 - LARGE ENSEMBLE (LENS2)" href="Notebook_lens2_south_atlantic_heat_balance_pi.html" />
    <link rel="prev" title="CESM2 - LARGE ENSEMBLE (LENS2)" href="Notebook_lens2_mocz.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    <p class="title logo__title">Analysis Project Template</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Introduction
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Notebook_amoc_samoc.html">CESM2 - LARGE ENSEMBLE (LENS2)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Notebook_amoc_south_atlantic_observations.html">CESM2 - LARGE ENSEMBLE (LENS2)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Notebook_glorys2v2_moc.html">Compute MOCfor the CMEMS Reanalysis</a></li>








<li class="toctree-l1"><a class="reference internal" href="Notebook_heat_storage_plots.html">CESM2 - LARGE ENSEMBLE (LENS2)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Notebook_lens2_moc_upper_branch.html">CESM2 - LARGE ENSEMBLE (LENS2)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Notebook_lens2_mocsig2_1deg.html">CESM2 - LARGE ENSEMBLE (LENS2)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Notebook_lens2_mocz.html">CESM2 - LARGE ENSEMBLE (LENS2)</a></li>


<li class="toctree-l1 current active"><a class="current reference internal" href="#">CESM2 - LARGE ENSEMBLE (LENS2)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Notebook_lens2_south_atlantic_heat_balance_pi.html">CESM2 - LARGE ENSEMBLE (LENS2)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Notebook_lens2_south_atlantic_clouds.html">CESM2 - LARGE ENSEMBLE (LENS2)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Notebook_lens2_validation.html">CESM2 - LARGE ENSEMBLE (LENS2)</a></li>

<li class="toctree-l1"><a class="reference internal" href="Notebook_lens2_south_atlantic_shf_components.html">CESM2 - LARGE ENSEMBLE (LENS2)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Notebook_notes.html">CESM2 - LARGE ENSEMBLE (LENS2)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Notebook_south_atlantic_area.html">CESM2 - LARGE ENSEMBLE (LENS2)</a></li>




<li class="toctree-l1"><a class="reference internal" href="Notebook_south_atlantic_hovmoller_diagrams.html">CESM2 - LARGE ENSEMBLE (LENS2)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Notebook_south_atlantic_masks.html">Build masks</a></li>













<li class="toctree-l1"><a class="reference internal" href="Notebook_south_atlantic_plots_temporal_series.html">CESM2 - LARGE ENSEMBLE (LENS2)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Notebook_south_atlantic_surface_analyses_atm_comp.html">CESM2 - LARGE ENSEMBLE (LENS2)</a></li>

<li class="toctree-l1"><a class="reference internal" href="Notebook_south_atlantic_surface_analyses_ocn_comp.html">CESM2 - LARGE ENSEMBLE (LENS2)</a></li>

</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/Notebook_lens2_south_atlantic_heat_balance.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>CESM2 - LARGE ENSEMBLE (LENS2)</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">Imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dask">Dask</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#read-the-data">Read the data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#concatenation-of-variables">Concatenation of variables</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#import-pop-grid">Import POP grid</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#calculate-the-difference-in-heat-transport-to-latitudes-closer-to-the-equator-and-34s">Calculate the difference in heat transport to latitudes closer to the equator and 34S</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tendency">Tendency</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cut-and-center-the-variable-in-the-south-atlantic">Cut and center the variable in the South Atlantic</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mask-the-continent">Mask the continent</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#integrate-the-shf-in-the-area">Integrate the SHF in the area</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#compute-the-heat-balance">Compute the heat balance</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#compute-the-heat-storage-hs-to-compare-with-the-heat-storage-due-to-the-difference-between-the-heat-fluxes">Compute the heat storage (HS) to compare with the heat storage due to the difference between the heat fluxes</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#equation-rm-hs-uprho-uptheta-c-p-int-z-2-z-1-uptheta-z-dz">Equation: $<span class="math notranslate nohighlight">\(\rm{HS = \uprho_\uptheta~C_p~\int_{z_2}^{z_1}\uptheta_{(z)}'~dz},\)</span>$</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#where">where:</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#hs-is-heat-storage-rm-j-m-2">* HS is heat storage (<span class="math notranslate nohighlight">\(\rm{J~m^{-2}}\)</span>),</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#uprho-uptheta-is-the-density-of-sea-water">* <span class="math notranslate nohighlight">\(\uprho_\uptheta\)</span> is the density of sea water,</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#rm-c-p-is-the-specific-heat-of-sea-water">* <span class="math notranslate nohighlight">\(\rm{C_p}\)</span> is the specific heat of sea water,</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#rm-z-is-the-depth-limit-on-the-calculation-in-meters">* <span class="math notranslate nohighlight">\(\rm{z}\)</span> is the depth limit on the calculation in meters,</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#and-uptheta-is-the-potential-temperature-monthly-anomaly-successor-month-minus-previous-month-at-each-depth-in-degress-kelvin-or-celsius-or-the-temperature-tendency">* and <span class="math notranslate nohighlight">\(\uptheta\)</span>â€™ is the potential temperature monthly anomaly (successor month minus previous month) at each depth in degress Kelvin or Celsius or, the temperature tendency.</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#calculate-the-heat-stored-per-layer">Calculate the heat stored per layer</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="cesm2-large-ensemble-lens2">
<h1>CESM2 - LARGE ENSEMBLE (LENS2)<a class="headerlink" href="#cesm2-large-ensemble-lens2" title="Permalink to this heading">#</a></h1>
<ul class="simple">
<li><p>This Notebooks aims to compute the heat balance in the South Atlantic, defined by the difference of the meridional heat transport from the northern and southern boundaries and the total surface heat flux (area integral)</p></li>
</ul>
<section id="imports">
<h2>Imports<a class="headerlink" href="#imports" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span> 
<span class="kn">import</span> <span class="nn">dask</span>
<span class="kn">import</span> <span class="nn">cf_xarray</span>
<span class="kn">import</span> <span class="nn">intake</span>
<span class="kn">import</span> <span class="nn">cftime</span>
<span class="kn">import</span> <span class="nn">nc_time_axis</span>
<span class="kn">import</span> <span class="nn">intake_esm</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">pop_tools</span>
<span class="kn">from</span> <span class="nn">dask.distributed</span> <span class="kn">import</span> <span class="n">Client</span><span class="p">,</span> <span class="n">wait</span>
<span class="kn">from</span> <span class="nn">ncar_jobqueue</span> <span class="kn">import</span> <span class="n">NCARCluster</span>
<span class="kn">import</span> <span class="nn">warnings</span><span class="o">,</span> <span class="nn">getpass</span><span class="o">,</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1.inset_locator</span> <span class="kn">import</span> <span class="n">inset_axes</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="kn">import</span> <span class="n">make_axes_locatable</span>
<span class="kn">import</span> <span class="nn">cartopy.crs</span> <span class="k">as</span> <span class="nn">ccrs</span>
<span class="kn">import</span> <span class="nn">cmocean</span>
<span class="kn">import</span> <span class="nn">dask</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="dask">
<h2>Dask<a class="headerlink" href="#dask" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mem_per_worker</span> <span class="o">=</span> <span class="mi">60</span> <span class="c1"># memory per worker in GB </span>
<span class="n">num_workers</span> <span class="o">=</span> <span class="mi">40</span> <span class="c1"># number of workers</span>
<span class="n">cluster</span> <span class="o">=</span> <span class="n">NCARCluster</span><span class="p">(</span><span class="n">cores</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">processes</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">memory</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">mem_per_worker</span><span class="si">}</span><span class="s1"> GB&#39;</span><span class="p">,</span><span class="n">resource_spec</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;select=1:ncpus=1:mem=</span><span class="si">{</span><span class="n">mem_per_worker</span><span class="si">}</span><span class="s1">GB&#39;</span><span class="p">,</span> <span class="n">walltime</span><span class="o">=</span><span class="s1">&#39;2:00:00&#39;</span><span class="p">)</span>
<span class="n">cluster</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">num_workers</span><span class="p">)</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">cluster</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
<span class="n">client</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="read-the-data">
<h2>Read the data<a class="headerlink" href="#read-the-data" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">catalog</span> <span class="o">=</span> <span class="n">intake</span><span class="o">.</span><span class="n">open_esm_datastore</span><span class="p">(</span>
    <span class="s1">&#39;/glade/collections/cmip/catalog/intake-esm-datastore/catalogs/glade-cesm2-le.json&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cat_subset</span> <span class="o">=</span> <span class="n">catalog</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">component</span><span class="o">=</span><span class="s1">&#39;ocn&#39;</span><span class="p">,</span><span class="n">variable</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;TEND_TEMP&#39;</span><span class="p">,</span><span class="s1">&#39;SHF&#39;</span><span class="p">,</span><span class="s1">&#39;N_HEAT&#39;</span><span class="p">],</span><span class="n">frequency</span><span class="o">=</span><span class="s1">&#39;month_1&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load catalog entries for subset into a dictionary of xarray datasets</span>
<span class="n">dset_dict_raw</span>  <span class="o">=</span> <span class="n">cat_subset</span><span class="o">.</span><span class="n">to_dataset_dict</span><span class="p">(</span><span class="n">zarr_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;consolidated&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span> <span class="n">storage_options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;anon&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Dataset dictionary keys:</span><span class="se">\n</span><span class="s1"> </span><span class="si">{</span><span class="n">dset_dict_raw</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="concatenation-of-variables">
<h2>Concatenation of variables<a class="headerlink" href="#concatenation-of-variables" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ff</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;cmip6&#39;</span><span class="p">,</span><span class="s1">&#39;smbb&#39;</span><span class="p">)</span>               <span class="c1"># Forcings</span>
<span class="n">fb</span><span class="o">=</span><span class="p">([</span><span class="s1">&#39;TEND_TEMP&#39;</span><span class="p">,</span><span class="s1">&#39;SHF&#39;</span><span class="p">,</span><span class="s1">&#39;N_HEAT&#39;</span><span class="p">])</span> <span class="c1"># Variable</span>

<span class="n">ds_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">fb</span><span class="p">:</span>
    <span class="c1"># 1- combine historical and ssp370 (concatenate in time)</span>
    <span class="n">ds_dict_tmp</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">scenario</span> <span class="ow">in</span> <span class="n">ff</span><span class="p">:</span>
        <span class="n">ds_dict_tmp</span><span class="p">[</span><span class="n">scenario</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">combine_nested</span><span class="p">([</span><span class="n">dset_dict_raw</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;ocn.historical.pop.h.</span><span class="si">{</span><span class="n">scenario</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">],</span> <span class="n">dset_dict_raw</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;ocn.ssp370.pop.h.</span><span class="si">{</span><span class="n">scenario</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]],</span><span class="n">concat_dim</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
        
        <span class="c1"># 2- combine cmip6 and smbb (concatenate in member_id)</span>
    <span class="n">ds_dict</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">combine_nested</span><span class="p">([</span><span class="n">ds_dict_tmp</span><span class="p">[</span><span class="s1">&#39;cmip6&#39;</span><span class="p">],</span> <span class="n">ds_dict_tmp</span><span class="p">[</span><span class="s1">&#39;smbb&#39;</span><span class="p">]],</span> <span class="n">concat_dim</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;member_id&#39;</span><span class="p">])</span>
    <span class="k">del</span> <span class="n">ds_dict_tmp</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dz</span><span class="o">=</span><span class="n">ds_dict</span><span class="p">[</span><span class="s1">&#39;TEND_TEMP&#39;</span><span class="p">][</span><span class="s1">&#39;dz&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">member_id</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="mf">0.01</span> <span class="c1"># 0.01 to convert cm into m </span>
<span class="c1"># Test</span>
<span class="n">dz</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="import-pop-grid">
<h2>Import POP grid<a class="headerlink" href="#import-pop-grid" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pop_grid</span> <span class="o">=</span> <span class="n">pop_tools</span><span class="o">.</span><span class="n">get_grid</span><span class="p">(</span><span class="s1">&#39;POP_gx1v7&#39;</span><span class="p">)</span>
<span class="n">ds_dict</span><span class="p">[</span><span class="s1">&#39;TLONG&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pop_grid</span><span class="o">.</span><span class="n">TLONG</span><span class="p">;</span> <span class="n">ds_dict</span><span class="p">[</span><span class="s1">&#39;TLAT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pop_grid</span><span class="o">.</span><span class="n">TLAT</span>
<span class="n">ds_dict</span><span class="p">[</span><span class="s1">&#39;ULONG&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pop_grid</span><span class="o">.</span><span class="n">ULONG</span><span class="p">;</span> <span class="n">ds_dict</span><span class="p">[</span><span class="s1">&#39;ULAT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pop_grid</span><span class="o">.</span><span class="n">ULAT</span>
<span class="k">del</span> <span class="n">pop_grid</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="calculate-the-difference-in-heat-transport-to-latitudes-closer-to-the-equator-and-34s">
<h2>Calculate the difference in heat transport to latitudes closer to the equator and 34S<a class="headerlink" href="#calculate-the-difference-in-heat-transport-to-latitudes-closer-to-the-equator-and-34s" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>We chose 34 instead of 34.5S because at 34S we are sure that there is no water leakage South Africa</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="c1">#ilan = 0 # northernmost latitude</span>
<span class="n">ilas</span> <span class="o">=</span> <span class="o">-</span><span class="mi">34</span> <span class="c1"># southernmost latitude</span>
<span class="n">Vt_n</span><span class="o">=</span><span class="n">ds_dict</span><span class="p">[</span><span class="s1">&#39;N_HEAT&#39;</span><span class="p">][</span><span class="s1">&#39;N_HEAT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">transport_reg</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;transport_comp&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">lat_aux_grid</span><span class="o">=</span><span class="mi">190</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
<span class="n">Vt_s</span><span class="o">=</span><span class="n">ds_dict</span><span class="p">[</span><span class="s1">&#39;N_HEAT&#39;</span><span class="p">][</span><span class="s1">&#39;N_HEAT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">transport_reg</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;transport_comp&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat_aux_grid</span><span class="o">=</span><span class="n">ilas</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Vt_n</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="mi">3000</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="tendency">
<h2>Tendency<a class="headerlink" href="#tendency" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">myfunc</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">slope</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">intercept</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Meridional Heat Transport Difference</span>
<span class="n">Vt_s_trends</span><span class="o">=</span><span class="n">Vt_s</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s1">&#39;1Y&#39;</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="s1">&#39;2015-01-01&#39;</span><span class="p">,</span><span class="s1">&#39;2100-12-31&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;member_id&#39;</span><span class="p">)</span>

<span class="n">Vt_n_trends</span><span class="o">=</span><span class="n">Vt_n</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s1">&#39;1Y&#39;</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="s1">&#39;2015-01-01&#39;</span><span class="p">,</span><span class="s1">&#39;2100-12-31&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;member_id&#39;</span><span class="p">)</span>

<span class="n">Vt_sn_trends</span><span class="o">=</span><span class="p">(</span><span class="n">Vt_n</span><span class="o">-</span><span class="n">Vt_s</span><span class="p">)</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s1">&#39;1Y&#39;</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="s1">&#39;2015-01-01&#39;</span><span class="p">,</span><span class="s1">&#39;2100-12-31&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;member_id&#39;</span><span class="p">)</span>

<span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">Vt_s_trends</span><span class="p">)))</span>
<span class="n">slope</span><span class="p">,</span> <span class="n">intercept</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">std_err</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Vt_s_trends</span><span class="p">)</span>
<span class="n">mymodel_Vt_s_trends</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">myfunc</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
<span class="n">mymodel_Vt_s_trends</span><span class="o">=</span><span class="n">mymodel_Vt_s_trends</span>
<span class="n">m_Vt_s_trends</span><span class="o">=</span><span class="n">slope</span><span class="o">*</span><span class="mi">10</span> <span class="c1"># per decade</span>
<span class="n">p_Vt_s_trends</span><span class="o">=</span><span class="n">p</span>
<span class="n">r_Vt_s_trends</span><span class="o">=</span><span class="n">r</span><span class="o">*</span><span class="n">r</span>

<span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">Vt_n_trends</span><span class="p">)))</span>
<span class="n">slope</span><span class="p">,</span> <span class="n">intercept</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">std_err</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Vt_n_trends</span><span class="p">)</span>
<span class="n">mymodel_Vt_n_trends</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">myfunc</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
<span class="n">mymodel_Vt_n_trends</span><span class="o">=</span><span class="n">mymodel_Vt_n_trends</span>
<span class="n">m_Vt_n_trends</span><span class="o">=</span><span class="n">slope</span><span class="o">*</span><span class="mi">10</span> <span class="c1"># per decade</span>
<span class="n">p_Vt_n_trends</span><span class="o">=</span><span class="n">p</span>
<span class="n">r_Vt_n_trends</span><span class="o">=</span><span class="n">r</span><span class="o">*</span><span class="n">r</span>

<span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">Vt_sn_trends</span><span class="p">)))</span>
<span class="n">slope</span><span class="p">,</span> <span class="n">intercept</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">std_err</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Vt_sn_trends</span><span class="p">)</span>
<span class="n">mymodel_Vt_sn_trends</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">myfunc</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
<span class="n">mymodel_Vt_sn_trends</span><span class="o">=</span><span class="n">mymodel_Vt_sn_trends</span>
<span class="n">m_Vt_sn_trends</span><span class="o">=</span><span class="n">slope</span><span class="o">*</span><span class="mi">10</span> <span class="c1"># per decade</span>
<span class="n">p_Vt_sn_trends</span><span class="o">=</span><span class="n">p</span>
<span class="n">r_Vt_sn_trends</span><span class="o">=</span><span class="n">r</span><span class="o">*</span><span class="n">r</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">Vt_s</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;member_id&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="s1">&#39;1850-01-01&#39;</span><span class="p">,</span><span class="s1">&#39;2100-12-31&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s1">&#39;1Y&#39;</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\rm</span><span class="si">{MHT}</span><span class="s1">: 34^oS$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Vt_s</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s1">&#39;1Y&#39;</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="s1">&#39;2015-01-01&#39;</span><span class="p">,</span><span class="s1">&#39;2100-12-31&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span><span class="n">mymodel_Vt_s_trends</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">m_Vt_s_trends</span><span class="o">*</span><span class="mi">1000</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> TW per decade&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">xycoords</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>


<span class="n">Vt_n</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;member_id&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="s1">&#39;1850-01-01&#39;</span><span class="p">,</span><span class="s1">&#39;2100-12-31&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s1">&#39;1Y&#39;</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\rm</span><span class="si">{MHT}</span><span class="s1">: 0^o$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Vt_n</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s1">&#39;1Y&#39;</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="s1">&#39;2015-01-01&#39;</span><span class="p">,</span><span class="s1">&#39;2100-12-31&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span><span class="n">mymodel_Vt_n_trends</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">m_Vt_n_trends</span><span class="o">*</span><span class="mi">1000</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> TW per decade&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">xycoords</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>


<span class="p">(</span><span class="n">Vt_n</span><span class="o">-</span><span class="n">Vt_s</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;member_id&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="s1">&#39;1850-01-01&#39;</span><span class="p">,</span><span class="s1">&#39;2100-12-31&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s1">&#39;1Y&#39;</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\rm</span><span class="si">{MHTD}</span><span class="s1">: 0^o-34^oS$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="n">Vt_n</span><span class="o">-</span><span class="n">Vt_s</span><span class="p">)</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s1">&#39;1Y&#39;</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="s1">&#39;2015-01-01&#39;</span><span class="p">,</span><span class="s1">&#39;2100-12-31&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span><span class="n">mymodel_Vt_sn_trends</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">m_Vt_sn_trends</span><span class="o">*</span><span class="mi">1000</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> TW per decade&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.38</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">xycoords</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Heat Flux [PW]&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mf">0.15</span><span class="p">,</span><span class="mf">0.85</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">Vt_n</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="mi">1319</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">Vt_n</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="mi">3000</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">Vt_n</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="s1">&#39;2015-01-01&#39;</span><span class="p">,</span><span class="s1">&#39;2100-12-31&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.9</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time [Years]&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;MHT.png&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">ilan</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># northernmost latitude</span>
<span class="n">ilas</span> <span class="o">=</span> <span class="o">-</span><span class="mi">34</span> <span class="c1"># southernmost latitude</span>
<span class="n">ds_N_HEAT_diff</span><span class="o">=</span><span class="p">(</span><span class="n">ds_dict</span><span class="p">[</span><span class="s1">&#39;N_HEAT&#39;</span><span class="p">][</span><span class="s1">&#39;N_HEAT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">transport_reg</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">lat_aux_grid</span><span class="o">=</span><span class="mi">190</span><span class="p">)</span><span class="o">-</span><span class="n">ds_dict</span><span class="p">[</span><span class="s1">&#39;N_HEAT&#39;</span><span class="p">][</span><span class="s1">&#39;N_HEAT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">transport_reg</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lat_aux_grid</span><span class="o">=</span><span class="n">ilas</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;transport_comp&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="cut-and-center-the-variable-in-the-south-atlantic">
<h2>Cut and center the variable in the South Atlantic<a class="headerlink" href="#cut-and-center-the-variable-in-the-south-atlantic" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="c1"># Cutting out and centering the variables in the South Atlantic</span>
<span class="n">dask</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">set</span><span class="p">({</span><span class="s2">&quot;array.slicing.split_large_chunks&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
<span class="n">ilon1</span><span class="p">,</span> <span class="n">flon1</span><span class="p">,</span> <span class="n">ilon2</span><span class="p">,</span> <span class="n">flon2</span> <span class="o">=</span> <span class="mi">307</span><span class="p">,</span> <span class="mi">320</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">54</span> <span class="c1"># longitude (initial (i), final (f)) </span>

<span class="n">fb</span><span class="o">=</span><span class="p">([</span><span class="s1">&#39;TEND_TEMP&#39;</span><span class="p">,</span><span class="s1">&#39;SHF&#39;</span><span class="p">])</span>

<span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">fb</span><span class="p">:</span>
    <span class="n">ds_dict</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">xr</span><span class="o">.</span><span class="n">combine_nested</span><span class="p">([[</span>
        <span class="n">ds_dict</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">ds_dict</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">TLAT</span> <span class="o">&gt;=</span> <span class="n">ilas</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ds_dict</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">TLAT</span> <span class="o">&lt;=</span> <span class="n">ilan</span><span class="p">),</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span>
            <span class="n">nlon</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">ilon1</span><span class="p">,</span><span class="n">flon1</span><span class="p">)),</span>
        <span class="n">ds_dict</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">ds_dict</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">TLAT</span> <span class="o">&gt;=</span> <span class="n">ilas</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ds_dict</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">TLAT</span> <span class="o">&lt;=</span> <span class="n">ilan</span><span class="p">),</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span>
            <span class="n">nlon</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">ilon2</span><span class="p">,</span><span class="n">flon2</span><span class="p">))]],</span>
        <span class="n">concat_dim</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;nlat&#39;</span><span class="p">,</span><span class="s1">&#39;nlon&#39;</span><span class="p">])</span>   
    <span class="n">ds_dict</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;nlon&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">ds_dict</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;nlon&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">180</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span> <span class="o">-</span> <span class="mi">180</span> 
    <span class="n">ds_dict</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds_dict</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sortby</span><span class="p">(</span><span class="n">ds_dict</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">nlon</span><span class="p">)</span>
<span class="k">del</span> <span class="n">ilan</span><span class="p">,</span> <span class="n">ilas</span><span class="p">,</span> <span class="n">ilon1</span><span class="p">,</span> <span class="n">flon1</span><span class="p">,</span> <span class="n">ilon2</span><span class="p">,</span> <span class="n">flon2</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds_dict</span><span class="p">[</span><span class="s1">&#39;TEND_TEMP&#39;</span><span class="p">][</span><span class="s1">&#39;TEND_TEMP&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">member_id</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">z_t</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="mask-the-continent">
<h2>Mask the continent<a class="headerlink" href="#mask-the-continent" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fb</span><span class="o">=</span><span class="p">([</span><span class="s1">&#39;TEND_TEMP&#39;</span><span class="p">,</span><span class="s1">&#39;SHF&#39;</span><span class="p">])</span>
<span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">fb</span><span class="p">:</span>
    <span class="n">mask_array</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">mask_ocean</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">ds_dict</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;nlat&#39;</span><span class="p">]),</span> <span class="c1"># ocean</span>
                          <span class="nb">len</span><span class="p">(</span><span class="n">ds_dict</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;nlon&#39;</span><span class="p">]))</span>
                        <span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">ds_dict</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>  
    <span class="n">mask_land</span>  <span class="o">=</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">ds_dict</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;nlat&#39;</span><span class="p">]),</span> <span class="c1"># continent</span>
                          <span class="nb">len</span><span class="p">(</span><span class="n">ds_dict</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;nlon&#39;</span><span class="p">]))</span>
                        <span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">ds_dict</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>  
    <span class="n">mask_array</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mask_ocean</span> <span class="o">+</span> <span class="n">mask_land</span>
    <span class="n">ds_dict</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">][</span><span class="s1">&#39;TAREA&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">ds_dict</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">][</span><span class="s1">&#39;TAREA&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_array</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">1.</span><span class="p">)</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="mf">1e-4</span> <span class="c1"># 1e-4 to convert cm2 into m2</span>
    <span class="k">del</span> <span class="n">mask_array</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="integrate-the-shf-in-the-area">
<h2>Integrate the SHF in the area<a class="headerlink" href="#integrate-the-shf-in-the-area" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds_dict</span><span class="p">[</span><span class="s1">&#39;SHF&#39;</span><span class="p">][</span><span class="s1">&#39;TAREA&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">ds_dict</span><span class="p">[</span><span class="s1">&#39;SHF&#39;</span><span class="p">][</span><span class="s1">&#39;TAREA&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="n">chunks</span><span class="o">=</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">67</span><span class="p">))</span>
<span class="n">ds_dict</span><span class="p">[</span><span class="s1">&#39;SHF&#39;</span><span class="p">][</span><span class="s1">&#39;SHF&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">ds_dict</span><span class="p">[</span><span class="s1">&#39;SHF&#39;</span><span class="p">][</span><span class="s1">&#39;SHF&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="n">chunks</span><span class="o">=</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">1980</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">67</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">ds_SHF</span><span class="o">=</span><span class="n">ds_dict</span><span class="p">[</span><span class="s1">&#39;SHF&#39;</span><span class="p">][</span><span class="s1">&#39;TAREA&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">ds_dict</span><span class="p">[</span><span class="s1">&#39;SHF&#39;</span><span class="p">][</span><span class="s1">&#39;SHF&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mf">1e-15</span><span class="p">)</span> <span class="c1"># PW (1e-15 to convert the units from W to PW) </span>
<span class="n">ds_SHF</span><span class="o">=</span><span class="n">ds_SHF</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;nlat&#39;</span><span class="p">,</span><span class="s1">&#39;nlon&#39;</span><span class="p">],</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span> <span class="c1"># PW</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Test</span>
<span class="n">ds_N_HEAT_diff</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;member_id&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s1">&#39;1Y&#39;</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="s1">&#39;1851-01-01&#39;</span><span class="p">,</span><span class="s1">&#39;2100-12-31&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;MHTD&#39;</span><span class="p">)</span>
<span class="n">ds_SHF</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;member_id&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s1">&#39;1Y&#39;</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="s1">&#39;1851-01-01&#39;</span><span class="p">,</span><span class="s1">&#39;2100-12-31&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;SHF&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time [Years]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;PW&#39;</span><span class="p">)</span>
<span class="c1">#plt.savefig(&#39;Heat_balance.png&#39;,dpi=300,bbox_inches=&#39;tight&#39;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="compute-the-heat-balance">
<h2>Compute the heat balance<a class="headerlink" href="#compute-the-heat-balance" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds_SHF_N_HEAT_diff</span><span class="o">=</span><span class="n">ds_SHF</span><span class="o">-</span><span class="n">ds_N_HEAT_diff</span> <span class="c1"># PW</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Test</span>
<span class="n">ds_SHF_N_HEAT_diff</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;member_id&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s1">&#39;1Y&#39;</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="s1">&#39;1851-01-01&#39;</span><span class="p">,</span><span class="s1">&#39;2100-12-31&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;HS&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time [Years]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;PW&#39;</span><span class="p">)</span>
<span class="c1">#plt.savefig(&#39;Heat_storage.png&#39;,dpi=300,bbox_inches=&#39;tight&#39;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="alert alert-block alert-info">
Here it was necessary to do the difference and not the sum of the terms to get the heat balance. This is because the SHF convection is positive to the ocean. The balance is given by every heat flux entering from the surface (positive direction of the z-axis) is equal to every flux leaving from the meridional heat transport (positive direction of the y-axis). The meirdional heat transport has a positive y-axis direction, but the SHF has not a negative z-axis direction. 
</div></section>
<section id="compute-the-heat-storage-hs-to-compare-with-the-heat-storage-due-to-the-difference-between-the-heat-fluxes">
<h2>Compute the heat storage (HS) to compare with the heat storage due to the difference between the heat fluxes<a class="headerlink" href="#compute-the-heat-storage-hs-to-compare-with-the-heat-storage-due-to-the-difference-between-the-heat-fluxes" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>the vertical integral of the temperature tendency</p></li>
</ul>
<section id="equation-rm-hs-uprho-uptheta-c-p-int-z-2-z-1-uptheta-z-dz">
<h3>Equation: $<span class="math notranslate nohighlight">\(\rm{HS = \uprho_\uptheta~C_p~\int_{z_2}^{z_1}\uptheta_{(z)}'~dz},\)</span>$<a class="headerlink" href="#equation-rm-hs-uprho-uptheta-c-p-int-z-2-z-1-uptheta-z-dz" title="Permalink to this heading">#</a></h3>
<section id="where">
<h4>where:<a class="headerlink" href="#where" title="Permalink to this heading">#</a></h4>
</section>
<section id="hs-is-heat-storage-rm-j-m-2">
<h4>* HS is heat storage (<span class="math notranslate nohighlight">\(\rm{J~m^{-2}}\)</span>),<a class="headerlink" href="#hs-is-heat-storage-rm-j-m-2" title="Permalink to this heading">#</a></h4>
</section>
<section id="uprho-uptheta-is-the-density-of-sea-water">
<h4>* <span class="math notranslate nohighlight">\(\uprho_\uptheta\)</span> is the density of sea water,<a class="headerlink" href="#uprho-uptheta-is-the-density-of-sea-water" title="Permalink to this heading">#</a></h4>
</section>
<section id="rm-c-p-is-the-specific-heat-of-sea-water">
<h4>* <span class="math notranslate nohighlight">\(\rm{C_p}\)</span> is the specific heat of sea water,<a class="headerlink" href="#rm-c-p-is-the-specific-heat-of-sea-water" title="Permalink to this heading">#</a></h4>
</section>
<section id="rm-z-is-the-depth-limit-on-the-calculation-in-meters">
<h4>* <span class="math notranslate nohighlight">\(\rm{z}\)</span> is the depth limit on the calculation in meters,<a class="headerlink" href="#rm-z-is-the-depth-limit-on-the-calculation-in-meters" title="Permalink to this heading">#</a></h4>
</section>
<section id="and-uptheta-is-the-potential-temperature-monthly-anomaly-successor-month-minus-previous-month-at-each-depth-in-degress-kelvin-or-celsius-or-the-temperature-tendency">
<h4>* and <span class="math notranslate nohighlight">\(\uptheta\)</span>â€™ is the potential temperature monthly anomaly (successor month minus previous month) at each depth in degress Kelvin or Celsius or, the temperature tendency.<a class="headerlink" href="#and-uptheta-is-the-potential-temperature-monthly-anomaly-successor-month-minus-previous-month-at-each-depth-in-degress-kelvin-or-celsius-or-the-temperature-tendency" title="Permalink to this heading">#</a></h4>
</section>
</section>
</section>
<section id="calculate-the-heat-stored-per-layer">
<h2>Calculate the heat stored per layer<a class="headerlink" href="#calculate-the-heat-stored-per-layer" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
<span class="c1">#layers=(&#39;0&#39;,&#39;1e+5&#39;,&#39;2e+5&#39;)</span>
<span class="n">layers</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="s1">&#39;1e+5&#39;</span><span class="p">,</span><span class="s1">&#39;6e+5&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">layers</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Done with layer: </span><span class="si">{</span><span class="n">layer</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">var_array</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span> <span class="c1"># Build a list</span>
    <span class="k">for</span> <span class="n">member_id</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ds_dict</span><span class="p">[</span><span class="s1">&#39;TEND_TEMP&#39;</span><span class="p">][</span><span class="s1">&#39;TEND_TEMP&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;member_id&#39;</span><span class="p">])):</span> <span class="c1"># per member</span>
        <span class="n">st</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;ds_HS_TEMP=ds_dict[</span><span class="se">\&#39;</span><span class="s1">TEND_TEMP</span><span class="se">\&#39;</span><span class="s1">][</span><span class="se">\&#39;</span><span class="s1">TEND_TEMP</span><span class="se">\&#39;</span><span class="s1">].isel(member_id=member_id).sel(z_t=slice(</span><span class="si">{</span><span class="n">layers</span><span class="p">[</span><span class="n">layer</span><span class="p">]</span><span class="si">}</span><span class="s1">,</span><span class="si">{</span><span class="n">layers</span><span class="p">[</span><span class="n">layer</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">))*dz.sel(z_t=slice(</span><span class="si">{</span><span class="n">layers</span><span class="p">[</span><span class="n">layer</span><span class="p">]</span><span class="si">}</span><span class="s1">,</span><span class="si">{</span><span class="n">layers</span><span class="p">[</span><span class="n">layer</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">))&#39;</span> <span class="c1"># 1- Multiply by dz. Unit: oC.s-1.m</span>
        <span class="n">exec</span><span class="p">(</span><span class="n">st</span><span class="p">);</span> <span class="k">del</span> <span class="n">st</span>
        <span class="n">st</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;ds_HS_TEMP=ds_HS_TEMP*ds_dict[</span><span class="se">\&#39;</span><span class="s1">TEND_TEMP</span><span class="se">\&#39;</span><span class="s1">][</span><span class="se">\&#39;</span><span class="s1">TAREA</span><span class="se">\&#39;</span><span class="s1">].isel(member_id=member_id).sel(z_t=slice(</span><span class="si">{</span><span class="n">layers</span><span class="p">[</span><span class="n">layer</span><span class="p">]</span><span class="si">}</span><span class="s1">,</span><span class="si">{</span><span class="n">layers</span><span class="p">[</span><span class="n">layer</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">))&#39;</span> <span class="c1"># 2- Multiply by the area. Unit: oC.s-1.m3</span>
        <span class="n">exec</span><span class="p">(</span><span class="n">st</span><span class="p">);</span> <span class="k">del</span> <span class="n">st</span>
        <span class="n">ds_HS_TEMP</span><span class="o">=</span><span class="n">ds_HS_TEMP</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;z_t&#39;</span><span class="p">,</span><span class="s1">&#39;nlon&#39;</span><span class="p">,</span><span class="s1">&#39;nlat&#39;</span><span class="p">])</span> <span class="c1"># 3- Integral in dz,dy,dx. Unit: oC.s-1.m3</span>
        <span class="n">ds_HS_TEMP</span><span class="o">=</span><span class="n">ds_HS_TEMP</span><span class="o">*</span><span class="mi">1026</span> <span class="c1"># 4- Multiply by the density of the sea water. Unit: oC.s-1.kg</span>
        <span class="n">ds_HS_TEMP</span><span class="o">=</span><span class="n">ds_HS_TEMP</span><span class="o">*</span><span class="mi">3996</span> <span class="c1"># 5- Multiply by the heat capacity of the sea water. Unit: W</span>
        <span class="n">ds_HS_TEMP</span><span class="o">=</span><span class="n">ds_HS_TEMP</span><span class="o">*</span><span class="mf">1e-15</span> <span class="c1"># 6- Get the variable in PW </span>
        <span class="n">var_small</span><span class="o">=</span><span class="n">ds_HS_TEMP</span><span class="o">.</span><span class="n">load</span><span class="p">()</span> <span class="c1"># 7- Annual mean and load</span>
        <span class="n">var_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">var_small</span><span class="p">)</span> <span class="c1"># 8- Add items to the end of a given list</span>
        <span class="k">del</span> <span class="n">ds_HS_TEMP</span> 
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Done with member: </span><span class="si">{</span><span class="n">member_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> <span class="c1"># 9- Go to the next member</span>
    <span class="n">st</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;ds_HS_TEMP_merged_</span><span class="si">{</span><span class="n">layer</span><span class="si">}</span><span class="s1"> = xr.concat(var_array, dim=</span><span class="se">\&#39;</span><span class="s1">member_id</span><span class="se">\&#39;</span><span class="s1">, compat=</span><span class="se">\&#39;</span><span class="s1">override</span><span class="se">\&#39;</span><span class="s1">, join=</span><span class="se">\&#39;</span><span class="s1">override</span><span class="se">\&#39;</span><span class="s1">, coords=</span><span class="se">\&#39;</span><span class="s1">minimal</span><span class="se">\&#39;</span><span class="s1">)&#39;</span> <span class="c1"># 10- Concat the members   </span>
    <span class="n">exec</span><span class="p">(</span><span class="n">st</span><span class="p">);</span> <span class="k">del</span> <span class="n">st</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds_HS_TEMP_merged_0</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="s1">&#39;1852-01-01&#39;</span><span class="p">,</span><span class="s1">&#39;2100-12-31&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;member_id&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s1">&#39;1Y&#39;</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;0-1000&#39;</span><span class="p">)</span>
<span class="n">ds_HS_TEMP_merged_1</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="s1">&#39;1852-01-01&#39;</span><span class="p">,</span><span class="s1">&#39;2100-12-31&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;member_id&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s1">&#39;1Y&#39;</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;1000-6000&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds_out_var</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">merge</span><span class="p">([</span><span class="n">ds_HS_TEMP_merged_0</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;HS_0&#39;</span><span class="p">),</span> <span class="c1"># Heat Storage (first layer)</span>
                       <span class="n">ds_HS_TEMP_merged_1</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;HS_1&#39;</span><span class="p">),</span> <span class="c1"># Heat Storage (second layer)</span>
                      <span class="p">])</span> <span class="c1"># Total Surface Heat Flux</span>
<span class="n">ds_out_var</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Heat balance components per layers for the South Atlantic: HS_0 (0-1000m), HS_1 (1000-6000m)&#39;</span>
<span class="n">ds_out_var</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;PW&#39;</span>
<span class="n">ds_out_var</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;author&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Mauricio Rocha&#39;</span>
<span class="n">ds_out_var</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;mauricio.rocha@usp.br&#39;</span>
<span class="c1"># create a directory on scratch to save the output</span>
<span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;/glade/scratch/mauricio/Data/LENS2/HEAT_BALANCE/&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">getpass</span><span class="o">.</span><span class="n">getuser</span><span class="p">())</span>
<span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;mkdir -p &#39;</span><span class="o">+</span><span class="n">path</span><span class="p">)</span>
<span class="n">ds_out_var</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="s1">&#39;heat_storage_per_layer_0_6000m.nc&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "npl-2022b"
        },
        kernelOptions: {
            name: "npl-2022b",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'npl-2022b'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="Notebook_lens2_mocz.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">CESM2 - LARGE ENSEMBLE (LENS2)</p>
      </div>
    </a>
    <a class="right-next"
       href="Notebook_lens2_south_atlantic_heat_balance_pi.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">CESM2 - LARGE ENSEMBLE (LENS2)</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">Imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dask">Dask</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#read-the-data">Read the data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#concatenation-of-variables">Concatenation of variables</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#import-pop-grid">Import POP grid</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#calculate-the-difference-in-heat-transport-to-latitudes-closer-to-the-equator-and-34s">Calculate the difference in heat transport to latitudes closer to the equator and 34S</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tendency">Tendency</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cut-and-center-the-variable-in-the-south-atlantic">Cut and center the variable in the South Atlantic</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mask-the-continent">Mask the continent</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#integrate-the-shf-in-the-area">Integrate the SHF in the area</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#compute-the-heat-balance">Compute the heat balance</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#compute-the-heat-storage-hs-to-compare-with-the-heat-storage-due-to-the-difference-between-the-heat-fluxes">Compute the heat storage (HS) to compare with the heat storage due to the difference between the heat fluxes</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#equation-rm-hs-uprho-uptheta-c-p-int-z-2-z-1-uptheta-z-dz">Equation: $<span class="math notranslate nohighlight">\(\rm{HS = \uprho_\uptheta~C_p~\int_{z_2}^{z_1}\uptheta_{(z)}'~dz},\)</span>$</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#where">where:</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#hs-is-heat-storage-rm-j-m-2">* HS is heat storage (<span class="math notranslate nohighlight">\(\rm{J~m^{-2}}\)</span>),</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#uprho-uptheta-is-the-density-of-sea-water">* <span class="math notranslate nohighlight">\(\uprho_\uptheta\)</span> is the density of sea water,</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#rm-c-p-is-the-specific-heat-of-sea-water">* <span class="math notranslate nohighlight">\(\rm{C_p}\)</span> is the specific heat of sea water,</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#rm-z-is-the-depth-limit-on-the-calculation-in-meters">* <span class="math notranslate nohighlight">\(\rm{z}\)</span> is the depth limit on the calculation in meters,</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#and-uptheta-is-the-potential-temperature-monthly-anomaly-successor-month-minus-previous-month-at-each-depth-in-degress-kelvin-or-celsius-or-the-temperature-tendency">* and <span class="math notranslate nohighlight">\(\uptheta\)</span>â€™ is the potential temperature monthly anomaly (successor month minus previous month) at each depth in degress Kelvin or Celsius or, the temperature tendency.</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#calculate-the-heat-stored-per-layer">Calculate the heat stored per layer</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By NCAR ESDS Team
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      Â© Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>