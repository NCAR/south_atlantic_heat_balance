

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>CESM2 - LARGE ENSEMBLE (LENS2) &#8212; Analysis Project Template</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Notebook_lens2_south_atlantic_shf_components';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="CESM2 - LARGE ENSEMBLE (LENS2)" href="Notebook_notes.html" />
    <link rel="prev" title="CESM2 - LARGE ENSEMBLE (LENS2)" href="Notebook_lens2_validation.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    <p class="title logo__title">Analysis Project Template</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Introduction
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Notebook_amoc_samoc.html">CESM2 - LARGE ENSEMBLE (LENS2)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Notebook_amoc_south_atlantic_observations.html">CESM2 - LARGE ENSEMBLE (LENS2)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Notebook_glorys2v2_moc.html">Compute MOCfor the CMEMS Reanalysis</a></li>








<li class="toctree-l1"><a class="reference internal" href="Notebook_heat_storage_plots.html">CESM2 - LARGE ENSEMBLE (LENS2)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Notebook_lens2_moc_upper_branch.html">CESM2 - LARGE ENSEMBLE (LENS2)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Notebook_lens2_mocsig2_1deg.html">CESM2 - LARGE ENSEMBLE (LENS2)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Notebook_lens2_mocz.html">CESM2 - LARGE ENSEMBLE (LENS2)</a></li>


<li class="toctree-l1"><a class="reference internal" href="Notebook_lens2_south_atlantic_heat_balance.html">CESM2 - LARGE ENSEMBLE (LENS2)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Notebook_lens2_south_atlantic_heat_balance_pi.html">CESM2 - LARGE ENSEMBLE (LENS2)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Notebook_lens2_south_atlantic_clouds.html">CESM2 - LARGE ENSEMBLE (LENS2)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Notebook_lens2_validation.html">CESM2 - LARGE ENSEMBLE (LENS2)</a></li>

<li class="toctree-l1 current active"><a class="current reference internal" href="#">CESM2 - LARGE ENSEMBLE (LENS2)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Notebook_notes.html">CESM2 - LARGE ENSEMBLE (LENS2)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Notebook_south_atlantic_area.html">CESM2 - LARGE ENSEMBLE (LENS2)</a></li>




<li class="toctree-l1"><a class="reference internal" href="Notebook_south_atlantic_hovmoller_diagrams.html">CESM2 - LARGE ENSEMBLE (LENS2)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Notebook_south_atlantic_masks.html">Build masks</a></li>













<li class="toctree-l1"><a class="reference internal" href="Notebook_south_atlantic_plots_temporal_series.html">CESM2 - LARGE ENSEMBLE (LENS2)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Notebook_south_atlantic_surface_analyses_atm_comp.html">CESM2 - LARGE ENSEMBLE (LENS2)</a></li>

<li class="toctree-l1"><a class="reference internal" href="Notebook_south_atlantic_surface_analyses_ocn_comp.html">CESM2 - LARGE ENSEMBLE (LENS2)</a></li>

</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/Notebook_lens2_south_atlantic_shf_components.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>CESM2 - LARGE ENSEMBLE (LENS2)</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">Imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dask">Dask</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#read-the-data">Read the data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ocean-component">Ocean Component</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#import-pop-grid-for-the-ocean-component">Import POP grid for the ocean component</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cut-and-center-the-variable-in-the-south-atlantic">Cut and center the variable in the South Atlantic</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mask-the-continent">Mask the continent</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#integrate-in-the-area">Integrate in the area</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-ocean-component-does-not-provide-the-latent-heat-flux-but-we-can-calculate-it-as-follows">The ocean component does not provide the latent heat flux, but we can calculate it as follows:</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="cesm2-large-ensemble-lens2">
<h1>CESM2 - LARGE ENSEMBLE (LENS2)<a class="headerlink" href="#cesm2-large-ensemble-lens2" title="Permalink to this heading">#</a></h1>
<ul class="simple">
<li><p>This notebook aims to compute heat balance terms on the South Atlantic surface.</p></li>
</ul>
<section id="imports">
<h2>Imports<a class="headerlink" href="#imports" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span> 
<span class="kn">import</span> <span class="nn">dask</span>
<span class="kn">import</span> <span class="nn">cf_xarray</span>
<span class="kn">import</span> <span class="nn">intake</span>
<span class="kn">import</span> <span class="nn">cftime</span>
<span class="kn">import</span> <span class="nn">nc_time_axis</span>
<span class="kn">import</span> <span class="nn">intake_esm</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">pop_tools</span>
<span class="kn">from</span> <span class="nn">dask.distributed</span> <span class="kn">import</span> <span class="n">Client</span><span class="p">,</span> <span class="n">wait</span>
<span class="kn">from</span> <span class="nn">ncar_jobqueue</span> <span class="kn">import</span> <span class="n">NCARCluster</span>
<span class="kn">import</span> <span class="nn">warnings</span><span class="o">,</span> <span class="nn">getpass</span><span class="o">,</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1.inset_locator</span> <span class="kn">import</span> <span class="n">inset_axes</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="kn">import</span> <span class="n">make_axes_locatable</span>
<span class="kn">import</span> <span class="nn">cartopy.crs</span> <span class="k">as</span> <span class="nn">ccrs</span>
<span class="kn">import</span> <span class="nn">cmocean</span>
<span class="kn">import</span> <span class="nn">dask</span>
<span class="kn">from</span> <span class="nn">matplotlib.offsetbox</span> <span class="kn">import</span> <span class="n">AnchoredText</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="dask">
<h2>Dask<a class="headerlink" href="#dask" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mem_per_worker</span> <span class="o">=</span> <span class="mi">40</span> <span class="c1"># memory per worker in GB </span>
<span class="n">num_workers</span> <span class="o">=</span> <span class="mi">40</span> <span class="c1"># number of workers</span>
<span class="n">cluster</span> <span class="o">=</span> <span class="n">NCARCluster</span><span class="p">(</span><span class="n">cores</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                      <span class="n">processes</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                      <span class="n">memory</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">mem_per_worker</span><span class="si">}</span><span class="s1"> GB&#39;</span><span class="p">,</span>
                      <span class="n">resource_spec</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;select=1:ncpus=1:mem=</span><span class="si">{</span><span class="n">mem_per_worker</span><span class="si">}</span><span class="s1">GB&#39;</span><span class="p">,</span>
                      <span class="n">walltime</span><span class="o">=</span><span class="s1">&#39;2:00:00&#39;</span><span class="p">,</span>
                      <span class="n">log_directory</span><span class="o">=</span><span class="s1">&#39;./dask-logs&#39;</span><span class="p">,</span>
                     <span class="p">)</span>
<span class="n">cluster</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">num_workers</span><span class="p">)</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">cluster</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
<span class="n">client</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="read-the-data">
<h2>Read the data<a class="headerlink" href="#read-the-data" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">catalog</span> <span class="o">=</span> <span class="n">intake</span><span class="o">.</span><span class="n">open_esm_datastore</span><span class="p">(</span>
    <span class="s1">&#39;/glade/collections/cmip/catalog/intake-esm-datastore/catalogs/glade-cesm2-le.json&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="ocean-component">
<h3>Ocean Component<a class="headerlink" href="#ocean-component" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>

<span class="n">all_vars</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;LWDN_F&#39;</span><span class="p">,</span><span class="s1">&#39;SHF&#39;</span><span class="p">,</span><span class="s1">&#39;SHF_QSW&#39;</span><span class="p">,</span><span class="s1">&#39;LWUP_F&#39;</span><span class="p">,</span><span class="s1">&#39;EVAP_F&#39;</span><span class="p">,</span><span class="s1">&#39;SENH_F&#39;</span><span class="p">]</span>
<span class="n">cat_subset</span> <span class="o">=</span> <span class="n">catalog</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">component</span><span class="o">=</span><span class="s1">&#39;ocn&#39;</span><span class="p">,</span><span class="n">variable</span><span class="o">=</span><span class="n">all_vars</span><span class="p">,</span><span class="n">frequency</span><span class="o">=</span><span class="s1">&#39;month_1&#39;</span><span class="p">)</span>
<span class="c1"># Load catalog entries for subset into a dictionary of xarray datasets</span>
<span class="n">dset_dict_raw</span>  <span class="o">=</span> <span class="n">cat_subset</span><span class="o">.</span><span class="n">to_dataset_dict</span><span class="p">(</span><span class="n">zarr_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;consolidated&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span> <span class="n">storage_options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;anon&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span><span class="c1">#, xarray_open_kwargs=(&#39;chunks&#39;: {&#39;&#39;:}))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Dataset dictionary keys:</span><span class="se">\n</span><span class="s1"> </span><span class="si">{</span><span class="n">dset_dict_raw</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>

<span class="c1"># Concatenation of variables</span>
<span class="n">ff</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;cmip6&#39;</span><span class="p">,</span><span class="s1">&#39;smbb&#39;</span><span class="p">)</span>                      <span class="c1"># Forcings</span>
<span class="n">ds_dict_ocn</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">all_vars</span><span class="p">:</span>
    <span class="c1"># 1- combine historical and ssp370 (concatenate in time)</span>
    <span class="n">ds_dict_tmp</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">scenario</span> <span class="ow">in</span> <span class="n">ff</span><span class="p">:</span>
        <span class="n">ds_dict_tmp</span><span class="p">[</span><span class="n">scenario</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">combine_nested</span><span class="p">([</span><span class="n">dset_dict_raw</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;ocn.historical.pop.h.</span><span class="si">{</span><span class="n">scenario</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">],</span> <span class="n">dset_dict_raw</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;ocn.ssp370.pop.h.</span><span class="si">{</span><span class="n">scenario</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]],</span><span class="n">concat_dim</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
        
        <span class="c1"># 2- combine cmip6 and smbb (concatenate in member_id)</span>
    <span class="n">ds_dict_ocn</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">combine_nested</span><span class="p">([</span><span class="n">ds_dict_tmp</span><span class="p">[</span><span class="s1">&#39;cmip6&#39;</span><span class="p">],</span> <span class="n">ds_dict_tmp</span><span class="p">[</span><span class="s1">&#39;smbb&#39;</span><span class="p">]],</span> <span class="n">concat_dim</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;member_id&#39;</span><span class="p">])</span>
    <span class="k">del</span> <span class="n">ds_dict_tmp</span>

<span class="n">ds_dict_ocn</span><span class="p">[</span><span class="s1">&#39;EVAP_F&#39;</span><span class="p">][</span><span class="s1">&#39;latent_heat_vapor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds_dict_ocn</span><span class="p">[</span><span class="s1">&#39;EVAP_F&#39;</span><span class="p">][</span><span class="s1">&#39;latent_heat_vapor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="n">member_id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="import-pop-grid-for-the-ocean-component">
<h2>Import POP grid for the ocean component<a class="headerlink" href="#import-pop-grid-for-the-ocean-component" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pop_grid</span> <span class="o">=</span> <span class="n">pop_tools</span><span class="o">.</span><span class="n">get_grid</span><span class="p">(</span><span class="s1">&#39;POP_gx1v7&#39;</span><span class="p">)</span>
<span class="n">ds_dict_ocn</span><span class="p">[</span><span class="s1">&#39;TLONG&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pop_grid</span><span class="o">.</span><span class="n">TLONG</span><span class="p">;</span> <span class="n">ds_dict_ocn</span><span class="p">[</span><span class="s1">&#39;TLAT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pop_grid</span><span class="o">.</span><span class="n">TLAT</span>
<span class="n">ds_dict_ocn</span><span class="p">[</span><span class="s1">&#39;ULONG&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pop_grid</span><span class="o">.</span><span class="n">ULONG</span><span class="p">;</span> <span class="n">ds_dict_ocn</span><span class="p">[</span><span class="s1">&#39;ULAT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pop_grid</span><span class="o">.</span><span class="n">ULAT</span>
<span class="k">del</span> <span class="n">pop_grid</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="cut-and-center-the-variable-in-the-south-atlantic">
<h2>Cut and center the variable in the South Atlantic<a class="headerlink" href="#cut-and-center-the-variable-in-the-south-atlantic" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="c1"># Cutting out and centering the variables in the South Atlantic</span>
<span class="n">dask</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">set</span><span class="p">({</span><span class="s2">&quot;array.slicing.split_large_chunks&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>

<span class="c1"># Ocean component</span>
<span class="n">ilon1</span><span class="p">,</span> <span class="n">flon1</span><span class="p">,</span> <span class="n">ilon2</span><span class="p">,</span> <span class="n">flon2</span> <span class="o">=</span> <span class="mi">307</span><span class="p">,</span> <span class="mi">320</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">54</span> <span class="c1"># longitude (initial (i), final (f)) </span>
<span class="n">ilan</span><span class="o">=</span><span class="mi">0</span>
<span class="n">ilas</span><span class="o">=-</span><span class="mi">34</span>
<span class="n">fb</span><span class="o">=</span><span class="p">([</span><span class="s1">&#39;LWDN_F&#39;</span><span class="p">,</span><span class="s1">&#39;SHF&#39;</span><span class="p">,</span><span class="s1">&#39;SHF_QSW&#39;</span><span class="p">,</span><span class="s1">&#39;LWUP_F&#39;</span><span class="p">,</span><span class="s1">&#39;EVAP_F&#39;</span><span class="p">,</span><span class="s1">&#39;SENH_F&#39;</span><span class="p">])</span>
<span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">fb</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">var</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ds_dict_ocn</span><span class="p">:</span>
        <span class="k">continue</span>
    <span class="n">ds_dict_ocn</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">xr</span><span class="o">.</span><span class="n">combine_nested</span><span class="p">([[</span>
        <span class="n">ds_dict_ocn</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">ds_dict_ocn</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">TLAT</span> <span class="o">&gt;=</span> <span class="n">ilas</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ds_dict_ocn</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">TLAT</span> <span class="o">&lt;=</span> <span class="n">ilan</span><span class="p">),</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span>
            <span class="n">nlon</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">ilon1</span><span class="p">,</span><span class="n">flon1</span><span class="p">)),</span>
        <span class="n">ds_dict_ocn</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">ds_dict_ocn</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">TLAT</span> <span class="o">&gt;=</span> <span class="n">ilas</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ds_dict_ocn</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">TLAT</span> <span class="o">&lt;=</span> <span class="n">ilan</span><span class="p">),</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span>
            <span class="n">nlon</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">ilon2</span><span class="p">,</span><span class="n">flon2</span><span class="p">))]],</span>
        <span class="n">concat_dim</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;nlat&#39;</span><span class="p">,</span><span class="s1">&#39;nlon&#39;</span><span class="p">])</span>
    <span class="n">ds_dict_ocn</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;nlon&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">ds_dict_ocn</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;nlon&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">180</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span> <span class="o">-</span> <span class="mi">180</span> 
    <span class="n">ds_dict_ocn</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds_dict_ocn</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sortby</span><span class="p">(</span><span class="n">ds_dict_ocn</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">nlon</span><span class="p">)</span>
    <span class="c1"># ds_tmp1 = ds_dict_ocn[var].where((ds_dict_ocn[var].TLAT &gt;= ilas) &amp; (ds_dict_ocn[var].TLAT &lt;= ilan), drop=True).isel(</span>
    <span class="c1">#             nlon = slice(ilon1,flon1))</span>
    <span class="c1"># ds_tmp2 = ds_dict_ocn[var].where((ds_dict_ocn[var].TLAT &gt;= ilas) &amp; (ds_dict_ocn[var].TLAT &lt;= ilan), drop=True).isel(</span>
    <span class="c1">#             nlon = slice(ilon2,flon2))</span>
    <span class="c1"># ds_tmp3 = xr.combine_nested([[ds_tmp1, ds_tmp2]], concat_dim=[&#39;nlat&#39;,&#39;nlon&#39;])</span>
    <span class="c1"># ds_tmp4 = ds_tmp3.assign_coords({&#39;nlon&#39;: (ds_tmp3[f&#39;{var}&#39;].coords[&#39;nlon&#39;] + 180) % 360 - 180})</span>
    <span class="c1"># ds_dict_ocn[var] = ds_tmp4.sortby(ds_tmp4.coords[&#39;nlon&#39;])</span>
    <span class="c1"># del ds_tmp1, ds_tmp2, ds_tmp3, ds_tmp4</span>
<span class="n">ds_dict_ocn</span><span class="p">[</span><span class="s1">&#39;EVAP_F&#39;</span><span class="p">][</span><span class="s1">&#39;latent_heat_vapor&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="mask-the-continent">
<h2>Mask the continent<a class="headerlink" href="#mask-the-continent" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>The area saved by the ocean component needs to be masked over the continent</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">fb</span><span class="o">=</span><span class="p">([</span><span class="s1">&#39;SHF&#39;</span><span class="p">])</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">fb</span><span class="p">:</span>
    <span class="n">mask_array</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">mask_ocean</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">ds_dict_ocn</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;nlat&#39;</span><span class="p">]),</span> <span class="c1"># ocean</span>
                          <span class="nb">len</span><span class="p">(</span><span class="n">ds_dict_ocn</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;nlon&#39;</span><span class="p">]))</span>
                        <span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">ds_dict_ocn</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>  
    <span class="n">mask_land</span>  <span class="o">=</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">ds_dict_ocn</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;nlat&#39;</span><span class="p">]),</span> <span class="c1"># continent</span>
                          <span class="nb">len</span><span class="p">(</span><span class="n">ds_dict_ocn</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;nlon&#39;</span><span class="p">]))</span>
                        <span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">ds_dict_ocn</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>  
    <span class="n">mask_array</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mask_ocean</span> <span class="o">+</span> <span class="n">mask_land</span>
    <span class="n">ds_dict_ocn</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">][</span><span class="s1">&#39;TAREA&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">ds_dict_ocn</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">][</span><span class="s1">&#39;TAREA&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_array</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">1.</span><span class="p">)</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="mf">1e-4</span> <span class="c1"># cm -&gt; m</span>
    <span class="k">del</span> <span class="n">mask_array</span>
<span class="c1"># ds_dict_ocn[&#39;SHF&#39;][&#39;TAREA&#39;]=ds_dict_ocn[&#39;SHF&#39;][&#39;TAREA&#39;].chunk(chunks=(50,1,67)) </span>
<span class="n">ds_dict_ocn</span><span class="p">[</span><span class="s1">&#39;SHF&#39;</span><span class="p">][</span><span class="s1">&#39;TAREA&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">ds_dict_ocn</span><span class="p">[</span><span class="s1">&#39;SHF&#39;</span><span class="p">][</span><span class="s1">&#39;TAREA&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
<span class="n">ds_dict_ocn</span><span class="p">[</span><span class="s1">&#39;SHF&#39;</span><span class="p">][</span><span class="s1">&#39;TAREA&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="integrate-in-the-area">
<h2>Integrate in the area<a class="headerlink" href="#integrate-in-the-area" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>We rearrange the size of the chunks and calculate the integral in the data area. We do this for each component, because they have different grids, i.e. different areas of each cell. However, the total area has to be the same. If it is not because of the differences in the grids, we might need to do some interpolation</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="c1"># Ocean component</span>
<span class="n">fb</span><span class="o">=</span><span class="p">([</span><span class="s1">&#39;LWDN_F&#39;</span><span class="p">,</span><span class="s1">&#39;SHF&#39;</span><span class="p">,</span><span class="s1">&#39;SHF_QSW&#39;</span><span class="p">,</span><span class="s1">&#39;LWUP_F&#39;</span><span class="p">,</span><span class="s1">&#39;SENH_F&#39;</span><span class="p">])</span>
<span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">fb</span><span class="p">:</span>
    <span class="n">ds_dict_ocn</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">ds_dict_ocn</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="n">chunks</span><span class="o">=</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">1980</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">67</span><span class="p">))</span>
    <span class="n">st</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;ds_</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">=[]&#39;</span> 
    <span class="n">exec</span><span class="p">(</span><span class="n">st</span><span class="p">)</span>
    <span class="n">st</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;ds_</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">=ds_dict_ocn[</span><span class="se">\&#39;</span><span class="s1">SHF</span><span class="se">\&#39;</span><span class="s1">][</span><span class="se">\&#39;</span><span class="s1">TAREA</span><span class="se">\&#39;</span><span class="s1">]*ds_dict_ocn[</span><span class="se">\&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="se">\&#39;</span><span class="s1">][</span><span class="se">\&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="se">\&#39;</span><span class="s1">]*(1e-15)&#39;</span> <span class="c1"># PW (1e-15 to convert the units from W to PW) </span>
    <span class="n">exec</span><span class="p">(</span><span class="n">st</span><span class="p">)</span>   
    <span class="n">st</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;ds_</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">=ds_</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">.sum(dim=[</span><span class="se">\&#39;</span><span class="s1">nlat</span><span class="se">\&#39;</span><span class="s1">,</span><span class="se">\&#39;</span><span class="s1">nlon</span><span class="se">\&#39;</span><span class="s1">],skipna=True).load()&#39;</span> <span class="c1"># PW</span>
    <span class="n">exec</span><span class="p">(</span><span class="n">st</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Done with variable: </span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> 
</pre></div>
</div>
</div>
</div>
</section>
<section id="the-ocean-component-does-not-provide-the-latent-heat-flux-but-we-can-calculate-it-as-follows">
<h2>The ocean component does not provide the latent heat flux, but we can calculate it as follows:<a class="headerlink" href="#the-ocean-component-does-not-provide-the-latent-heat-flux-but-we-can-calculate-it-as-follows" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">ds_dict_ocn</span><span class="p">[</span><span class="s1">&#39;EVAP_F&#39;</span><span class="p">][</span><span class="s1">&#39;latent_heat_vapor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds_dict_ocn</span><span class="p">[</span><span class="s1">&#39;EVAP_F&#39;</span><span class="p">][</span><span class="s1">&#39;latent_heat_vapor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">persist</span><span class="p">()</span>
<span class="n">wait</span><span class="p">(</span><span class="n">ds_dict_ocn</span><span class="p">[</span><span class="s1">&#39;EVAP_F&#39;</span><span class="p">][</span><span class="s1">&#39;latent_heat_vapor&#39;</span><span class="p">])</span>
<span class="n">ds_dict_ocn</span><span class="p">[</span><span class="s1">&#39;EVAP_F&#39;</span><span class="p">][</span><span class="s1">&#39;latent_heat_vapor&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">ds_dict_ocn</span><span class="p">[</span><span class="s1">&#39;EVAP_F&#39;</span><span class="p">][</span><span class="s1">&#39;EVAP_F&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds_dict_ocn</span><span class="p">[</span><span class="s1">&#39;EVAP_F&#39;</span><span class="p">][</span><span class="s1">&#39;EVAP_F&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">persist</span><span class="p">()</span>
<span class="n">wait</span><span class="p">(</span><span class="n">ds_dict_ocn</span><span class="p">[</span><span class="s1">&#39;EVAP_F&#39;</span><span class="p">][</span><span class="s1">&#39;EVAP_F&#39;</span><span class="p">])</span>
<span class="n">ds_dict_ocn</span><span class="p">[</span><span class="s1">&#39;EVAP_F&#39;</span><span class="p">][</span><span class="s1">&#39;EVAP_F&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">ds_LATENT_tmp</span> <span class="o">=</span> <span class="p">((</span><span class="n">ds_dict_ocn</span><span class="p">[</span><span class="s1">&#39;SHF&#39;</span><span class="p">][</span><span class="s1">&#39;TAREA&#39;</span> <span class="c1"># Area in m2</span>
                              <span class="p">]</span><span class="o">*</span><span class="n">ds_dict_ocn</span><span class="p">[</span><span class="s1">&#39;EVAP_F&#39;</span><span class="p">][</span><span class="s1">&#39;EVAP_F&#39;</span> <span class="c1"># Mass flux of water vapor in kg/m2/s </span>
                                                     <span class="p">]</span><span class="o">*</span><span class="n">ds_dict_ocn</span><span class="p">[</span><span class="s1">&#39;EVAP_F&#39;</span><span class="p">][</span><span class="s1">&#39;latent_heat_vapor&#39;</span> <span class="c1"># Latent Heat Vapor in J/kg</span>
                                                                            <span class="p">]))</span><span class="o">.</span><span class="n">persist</span><span class="p">()</span>
<span class="n">wait</span><span class="p">(</span><span class="n">ds_LATENT_tmp</span><span class="p">)</span>
<span class="n">ds_LATENT</span> <span class="o">=</span> <span class="n">ds_LATENT_tmp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;nlat&#39;</span><span class="p">,</span><span class="s1">&#39;nlon&#39;</span><span class="p">],</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">*</span><span class="mf">1e-15</span> <span class="c1"># W -&gt; PW</span>
<span class="n">ds_LATENT</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds_LATENT</span><span class="o">=</span><span class="n">ds_LATENT</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds_SHF</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;member_id&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s1">&#39;1Y&#39;</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="s1">&#39;1960-01-01&#39;</span><span class="p">,</span><span class="s1">&#39;2100-12-31&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;SHF1&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="n">ds_LWDN_F</span><span class="o">+</span><span class="n">ds_LWUP_F</span><span class="o">+</span><span class="n">ds_SHF_QSW</span><span class="o">+</span><span class="n">ds_SENH_F</span><span class="o">+</span><span class="n">ds_LATENT</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;member_id&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s1">&#39;1Y&#39;</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="s1">&#39;1960-01-01&#39;</span><span class="p">,</span><span class="s1">&#39;2100-12-31&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;SHF2&#39;</span><span class="p">)</span>
<span class="c1">#(ds_LWDN_F+ds_LWUP_F).mean(dim=[&#39;member_id&#39;]).resample(time=&#39;5Y&#39;, closed=&#39;left&#39;).mean(&#39;time&#39;).sel(time=slice(&#39;1960-01-01&#39;,&#39;2100-12-31&#39;)).plot(label=&#39;LW&#39;)</span>
<span class="c1">#(ds_SHF_QSW).mean(dim=[&#39;member_id&#39;]).resample(time=&#39;5Y&#39;, closed=&#39;left&#39;).mean(&#39;time&#39;).sel(time=slice(&#39;1960-01-01&#39;,&#39;2100-12-31&#39;)).plot(label=&#39;SW&#39;)</span>
<span class="c1">#(-ds_SHFLX).mean(dim=[&#39;member_id&#39;]).resample(time=&#39;5Y&#39;, closed=&#39;left&#39;).mean(&#39;time&#39;).sel(time=slice(&#39;1960-01-01&#39;,&#39;2100-12-31&#39;)).plot(label=&#39;SH&#39;)</span>
<span class="c1">#(-ds_LHFLX).mean(dim=[&#39;member_id&#39;]).resample(time=&#39;5Y&#39;, closed=&#39;left&#39;).mean(&#39;time&#39;).sel(time=slice(&#39;1960-01-01&#39;,&#39;2100-12-31&#39;)).plot(label=&#39;LH&#39;)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">calculate_ticks</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">ticks</span><span class="p">,</span> <span class="n">round_to</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">upperbound</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ybound</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">round_to</span><span class="p">)</span>
    <span class="n">lowerbound</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ybound</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">round_to</span><span class="p">)</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">upperbound</span> <span class="o">-</span> <span class="n">lowerbound</span>
    <span class="n">fit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">dy</span><span class="o">/</span><span class="p">(</span><span class="n">ticks</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">dy_new</span> <span class="o">=</span> <span class="p">(</span><span class="n">ticks</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">fit</span>
    <span class="k">if</span> <span class="n">center</span><span class="p">:</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">dy_new</span> <span class="o">-</span> <span class="n">dy</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">lowerbound</span> <span class="o">=</span> <span class="n">lowerbound</span> <span class="o">-</span> <span class="n">offset</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">lowerbound</span><span class="p">,</span> <span class="n">lowerbound</span> <span class="o">+</span> <span class="n">dy_new</span><span class="p">,</span> <span class="n">ticks</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">values</span><span class="o">*</span><span class="n">round_to</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">import</span> <span class="n">figure</span>
<span class="n">letts</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="s1">&#39;C&#39;</span><span class="p">,</span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="s1">&#39;E&#39;</span><span class="p">,</span><span class="s1">&#39;F&#39;</span><span class="p">]</span>
<span class="n">vari</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ds_SHF&#39;</span><span class="p">,</span><span class="s1">&#39;ds_LWDN_F&#39;</span><span class="p">,</span><span class="s1">&#39;ds_LWUP_F&#39;</span><span class="p">,</span><span class="s1">&#39;ds_SHF_QSW&#39;</span><span class="p">,</span><span class="s1">&#39;ds_SENH_F&#39;</span><span class="p">,</span><span class="s1">&#39;ds_LATENT&#39;</span><span class="p">]</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">ds_SHF</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;member_id&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s1">&#39;1Y&#39;</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="s1">&#39;1960-01-01&#39;</span><span class="p">,</span><span class="s1">&#39;2100-12-31&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;SHF1&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="n">ds_LWDN_F</span><span class="o">+</span><span class="n">ds_LWUP_F</span><span class="o">+</span><span class="n">ds_SHF_QSW</span><span class="o">+</span><span class="n">ds_SENH_F</span><span class="o">+</span><span class="n">ds_LATENT</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;member_id&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s1">&#39;1Y&#39;</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="s1">&#39;1960-01-01&#39;</span><span class="p">,</span><span class="s1">&#39;2100-12-31&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;SHF2&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="n">ds_LWDN_F</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;member_id&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s1">&#39;1Y&#39;</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="s1">&#39;1960-01-01&#39;</span><span class="p">,</span><span class="s1">&#39;2100-12-31&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;LWDN&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;maroon&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="n">ds_LWUP_F</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;member_id&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s1">&#39;1Y&#39;</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="s1">&#39;1960-01-01&#39;</span><span class="p">,</span><span class="s1">&#39;2100-12-31&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;LWUP&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="n">ds_SHF_QSW</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;member_id&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s1">&#39;1Y&#39;</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="s1">&#39;1960-01-01&#39;</span><span class="p">,</span><span class="s1">&#39;2100-12-31&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;SW&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="n">ds_SENH_F</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;member_id&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s1">&#39;1Y&#39;</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="s1">&#39;1960-01-01&#39;</span><span class="p">,</span><span class="s1">&#39;2100-12-31&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;SH&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="n">ds_LATENT</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;member_id&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s1">&#39;1Y&#39;</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="s1">&#39;1960-01-01&#39;</span><span class="p">,</span><span class="s1">&#39;2100-12-31&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;LH&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">axs</span><span class="p">)):</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper right&quot;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time [Years]&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span> 
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">);</span> <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">at</span> <span class="o">=</span> <span class="n">AnchoredText</span><span class="p">(</span><span class="n">letts</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">prop</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">),</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower left&#39;</span><span class="p">);</span> <span class="n">at</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">set_boxstyle</span><span class="p">(</span><span class="s2">&quot;round,pad=0.,rounding_size=0.2&quot;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">at</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">calculate_ticks</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">8</span><span class="p">))</span>
    
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Heat Flux [PW]&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.37</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;Qnet.png&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">myfunc</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">slope</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">intercept</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SHF_sts</span><span class="o">=</span><span class="n">ds_SHF</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;member_id&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s1">&#39;1Y&#39;</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="s1">&#39;2015-01-01&#39;</span><span class="p">,</span><span class="s1">&#39;2100-12-31&#39;</span><span class="p">))</span>
<span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">SHF_sts</span><span class="p">)))</span>
<span class="n">slope</span><span class="p">,</span> <span class="n">intercept</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">std_err</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">SHF_sts</span><span class="p">)</span>
<span class="n">mymodel_SHF_sts</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">myfunc</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
<span class="n">mymodel_SHF_sts</span><span class="o">=</span><span class="n">mymodel_SHF_sts</span>
<span class="n">m_SHF_sts</span><span class="o">=</span><span class="n">slope</span><span class="o">*</span><span class="mi">10</span> <span class="c1"># per decade</span>
<span class="n">p_SHF_sts</span><span class="o">=</span><span class="n">p</span>
<span class="n">r_SHF_sts</span><span class="o">=</span><span class="n">r</span><span class="o">*</span><span class="n">r</span>

<span class="n">Neg_sts</span><span class="o">=</span><span class="p">(</span><span class="n">ds_LWDN_F</span><span class="o">+</span><span class="n">ds_LWUP_F</span><span class="o">+</span><span class="n">ds_SENH_F</span><span class="o">+</span><span class="n">ds_LATENT</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;member_id&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s1">&#39;1Y&#39;</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="s1">&#39;2015-01-01&#39;</span><span class="p">,</span><span class="s1">&#39;2100-12-31&#39;</span><span class="p">))</span>
<span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">Neg_sts</span><span class="p">)))</span>
<span class="n">slope</span><span class="p">,</span> <span class="n">intercept</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">std_err</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Neg_sts</span><span class="p">)</span>
<span class="n">mymodel_Neg_sts</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">myfunc</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
<span class="n">mymodel_Neg_sts</span><span class="o">=</span><span class="n">mymodel_Neg_sts</span>
<span class="n">m_Neg_sts</span><span class="o">=</span><span class="n">slope</span><span class="o">*</span><span class="mi">10</span> <span class="c1"># per decade</span>
<span class="n">p_Neg_sts</span><span class="o">=</span><span class="n">p</span>
<span class="n">r_Neg_sts</span><span class="o">=</span><span class="n">r</span><span class="o">*</span><span class="n">r</span>
             
<span class="n">Pos_sts</span><span class="o">=</span><span class="n">ds_SHF_QSW</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;member_id&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s1">&#39;1Y&#39;</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="s1">&#39;2015-01-01&#39;</span><span class="p">,</span><span class="s1">&#39;2100-12-31&#39;</span><span class="p">))</span>
<span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">Pos_sts</span><span class="p">)))</span>
<span class="n">slope</span><span class="p">,</span> <span class="n">intercept</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">std_err</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Pos_sts</span><span class="p">)</span>
<span class="n">mymodel_Pos_sts</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">myfunc</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
<span class="n">mymodel_Pos_sts</span><span class="o">=</span><span class="n">mymodel_Pos_sts</span>
<span class="n">m_Pos_sts</span><span class="o">=</span><span class="n">slope</span><span class="o">*</span><span class="mi">10</span> <span class="c1"># per decade</span>
<span class="n">p_Pos_sts</span><span class="o">=</span><span class="n">p</span>
<span class="n">r_Pos_sts</span><span class="o">=</span><span class="n">r</span><span class="o">*</span><span class="n">r</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">import</span> <span class="n">figure</span>
<span class="n">letts</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="s1">&#39;C&#39;</span><span class="p">,</span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="s1">&#39;E&#39;</span><span class="p">]</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="p">(</span><span class="n">ds_LWDN_F</span><span class="o">+</span><span class="n">ds_LWUP_F</span><span class="o">+</span><span class="n">ds_SHF_QSW</span><span class="o">+</span><span class="n">ds_SENH_F</span><span class="o">+</span><span class="n">ds_LATENT</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;member_id&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s1">&#39;1Y&#39;</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="s1">&#39;1960-01-01&#39;</span><span class="p">,</span><span class="s1">&#39;2100-12-31&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;SHF2&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="n">ds_LWDN_F</span><span class="o">+</span><span class="n">ds_LWUP_F</span><span class="o">+</span><span class="n">ds_SENH_F</span><span class="o">+</span><span class="n">ds_LATENT</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;member_id&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s1">&#39;1Y&#39;</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="s1">&#39;1960-01-01&#39;</span><span class="p">,</span><span class="s1">&#39;2100-12-31&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;LWDW+LWUP+SH+LH&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;maroon&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="n">ds_SHF_QSW</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;member_id&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s1">&#39;1Y&#39;</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="s1">&#39;1960-01-01&#39;</span><span class="p">,</span><span class="s1">&#39;2100-12-31&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;SW&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="n">ds_LWDN_F</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;member_id&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s1">&#39;1Y&#39;</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="s1">&#39;2015-01-01&#39;</span><span class="p">,</span><span class="s1">&#39;2100-12-31&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span><span class="n">mymodel_SHF_sts</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">m_SHF_sts</span><span class="o">*</span><span class="mi">1000</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> TW per decade&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">xycoords</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="n">ds_LWDN_F</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;member_id&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s1">&#39;1Y&#39;</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="s1">&#39;2015-01-01&#39;</span><span class="p">,</span><span class="s1">&#39;2100-12-31&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span><span class="n">mymodel_Neg_sts</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;maroon&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">m_Neg_sts</span><span class="o">*</span><span class="mi">1000</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> TW per decade&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;maroon&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">xycoords</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="n">ds_LWDN_F</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;member_id&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s1">&#39;1Y&#39;</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="s1">&#39;2015-01-01&#39;</span><span class="p">,</span><span class="s1">&#39;2100-12-31&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span><span class="n">mymodel_Pos_sts</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">m_Pos_sts</span><span class="o">*</span><span class="mi">1000</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> TW per decade&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">xycoords</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">axs</span><span class="p">)):</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper right&quot;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time [Years]&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span> 
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">);</span> <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">at</span> <span class="o">=</span> <span class="n">AnchoredText</span><span class="p">(</span><span class="n">letts</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">prop</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">),</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">);</span> <span class="n">at</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">set_boxstyle</span><span class="p">(</span><span class="s2">&quot;round,pad=0.,rounding_size=0.2&quot;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">at</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">calculate_ticks</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Heat Flux [PW]&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;Qnet_1.png&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "npl-2022b"
        },
        kernelOptions: {
            name: "npl-2022b",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'npl-2022b'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="Notebook_lens2_validation.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">CESM2 - LARGE ENSEMBLE (LENS2)</p>
      </div>
    </a>
    <a class="right-next"
       href="Notebook_notes.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">CESM2 - LARGE ENSEMBLE (LENS2)</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">Imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dask">Dask</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#read-the-data">Read the data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ocean-component">Ocean Component</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#import-pop-grid-for-the-ocean-component">Import POP grid for the ocean component</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cut-and-center-the-variable-in-the-south-atlantic">Cut and center the variable in the South Atlantic</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mask-the-continent">Mask the continent</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#integrate-in-the-area">Integrate in the area</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-ocean-component-does-not-provide-the-latent-heat-flux-but-we-can-calculate-it-as-follows">The ocean component does not provide the latent heat flux, but we can calculate it as follows:</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By NCAR ESDS Team
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>