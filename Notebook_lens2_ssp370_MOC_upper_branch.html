
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>CESM2 - LARGE ENSEMBLE (LENS2) &#8212; Analysis Project Template</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="CESM2 - LARGE ENSEMBLE (LENS2)" href="Notebook_South_Atlantic_plots_temporal_series_historical.html" />
    <link rel="prev" title="CESM2 - LARGE ENSEMBLE (LENS2)" href="Notebook_lens2_historical_MOC_upper_branch.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Analysis Project Template</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Introduction
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="Notebook_Notes.html">
   CESM2 - LARGE ENSEMBLE (LENS2)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Notebook_South_Atlantic_Area.html">
   CESM2 - LARGE ENSEMBLE (LENS2)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Notebook_South_Atlantic_Surface_Analyses_ocn_comp_historical.html">
   CESM2 - LARGE ENSEMBLE (LENS2)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Notebook_South_Atlantic_Surface_Analyses_ocn_comp_ssp370.html">
   CESM2 - LARGE ENSEMBLE (LENS2)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Notebook_South_Atlantic_Surface_Analyses_atm_comp_historical.html">
   CESM2 - LARGE ENSEMBLE (LENS2)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Notebook_South_Atlantic_Surface_Analyses_atm_comp_ssp370.html">
   CESM2 - LARGE ENSEMBLE (LENS2)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Notebook_lens2_historical_MOCz_maxima.html">
   CESM2 - LARGE ENSEMBLE (LENS2)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Notebook_lens2_ssp370_MOCz_maxima.html">
   CESM2 - LARGE ENSEMBLE (LENS2)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Notebook_lens2_MOCsig2_1deg.html">
   CESM2 - LARGE ENSEMBLE (LENS2)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Notebook_lens2_historical_MOC_upper_branch.html">
   CESM2 - LARGE ENSEMBLE (LENS2)
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   CESM2 - LARGE ENSEMBLE (LENS2)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Notebook_South_Atlantic_plots_temporal_series_historical.html">
   CESM2 - LARGE ENSEMBLE (LENS2)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Notebook_ascii_netcdf.html">
   CESM2 - LARGE ENSEMBLE (LENS2)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Notebook_North_Atlantic_XMXL_hovmoller_diagrams_historical.html">
   CESM2 - LARGE ENSEMBLE (LENS2)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="south_atlantic_maks_gx1v7.html">
   Build masks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="glorys2v2_moc.html">
   Compute MOCfor the CMEMS Reanalysis
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/Notebook_lens2_ssp370_MOC_upper_branch.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="_sources/Notebook_lens2_ssp370_MOC_upper_branch.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   CESM2 - LARGE ENSEMBLE (LENS2)
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#by-mauricio-rocha-and-dr-gustavo-marques">
     by Mauricio Rocha and Dr. Gustavo Marques
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#imports">
   Imports
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dask">
   Dask
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#read-in-ogcm-ssp370-file-moc-template-file">
     Read in OGCM ssp370 file &amp; MOC template file
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#let-s-read-the-data-again-since-we-need-a-monthly-series">
     Let’s read the data again since we need a monthly series
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#what-does-the-vertical-profile-of-amoc-look-like">
     What does the vertical profile of AMOC look like?
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#interpolate-to-create-moc-data-in-the-middle-of-the-layer">
       Interpolate to create MOC data in the middle of the layer
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>CESM2 - LARGE ENSEMBLE (LENS2)</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   CESM2 - LARGE ENSEMBLE (LENS2)
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#by-mauricio-rocha-and-dr-gustavo-marques">
     by Mauricio Rocha and Dr. Gustavo Marques
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#imports">
   Imports
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dask">
   Dask
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#read-in-ogcm-ssp370-file-moc-template-file">
     Read in OGCM ssp370 file &amp; MOC template file
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#let-s-read-the-data-again-since-we-need-a-monthly-series">
     Let’s read the data again since we need a monthly series
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#what-does-the-vertical-profile-of-amoc-look-like">
     What does the vertical profile of AMOC look like?
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#interpolate-to-create-moc-data-in-the-middle-of-the-layer">
       Interpolate to create MOC data in the middle of the layer
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section id="cesm2-large-ensemble-lens2">
<h1>CESM2 - LARGE ENSEMBLE (LENS2)<a class="headerlink" href="#cesm2-large-ensemble-lens2" title="Permalink to this headline">#</a></h1>
<section id="by-mauricio-rocha-and-dr-gustavo-marques">
<h2>by Mauricio Rocha and Dr. Gustavo Marques<a class="headerlink" href="#by-mauricio-rocha-and-dr-gustavo-marques" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>This Notebook aims to compute the upper branch of the MOC at the 34.5oS (SAMBAR) for the future SSP370 scenario. The upper branch is the integrated volume transport from the surface to the level where the meridional volume transport inverts.</p></li>
</ul>
</section>
</section>
<section id="imports">
<h1>Imports<a class="headerlink" href="#imports" title="Permalink to this headline">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>  
<span class="kn">import</span> <span class="nn">dask</span>
<span class="kn">import</span> <span class="nn">cf_xarray</span>
<span class="kn">import</span> <span class="nn">intake</span>
<span class="kn">import</span> <span class="nn">cftime</span>
<span class="kn">import</span> <span class="nn">nc_time_axis</span>
<span class="kn">import</span> <span class="nn">intake_esm</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">pop_tools</span>
<span class="kn">from</span> <span class="nn">dask.distributed</span> <span class="kn">import</span> <span class="n">Client</span>
<span class="kn">from</span> <span class="nn">ncar_jobqueue</span> <span class="kn">import</span> <span class="n">NCARCluster</span>
<span class="kn">import</span> <span class="nn">warnings</span><span class="o">,</span> <span class="nn">getpass</span><span class="o">,</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1.inset_locator</span> <span class="kn">import</span> <span class="n">inset_axes</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">cumtrapz</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">integrate</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="dask">
<h1>Dask<a class="headerlink" href="#dask" title="Permalink to this headline">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mem_per_worker</span> <span class="o">=</span> <span class="mi">25</span> <span class="c1"># memory per worker in GB </span>
<span class="n">num_workers</span> <span class="o">=</span> <span class="mi">80</span> <span class="c1"># number of workers</span>
<span class="n">cluster</span> <span class="o">=</span> <span class="n">NCARCluster</span><span class="p">(</span><span class="n">cores</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">processes</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">memory</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">mem_per_worker</span><span class="si">}</span><span class="s1"> GB&#39;</span><span class="p">,</span><span class="n">resource_spec</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;select=1:ncpus=6:mem=</span><span class="si">{</span><span class="n">mem_per_worker</span><span class="si">}</span><span class="s1">GB&#39;</span><span class="p">)</span>
<span class="n">cluster</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">num_workers</span><span class="p">)</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">cluster</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
<span class="n">client</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Client: &#39;tcp://10.12.206.61:44309&#39; processes=0 threads=0, memory=0 B&gt;
</pre></div>
</div>
<div class="output text_html"><div>
    <div style="width: 24px; height: 24px; background-color: #e1e1e1; border: 3px solid #9D9D9D; border-radius: 5px; position: absolute;"> </div>
    <div style="margin-left: 48px;">
        <h3 style="margin-bottom: 0px;">Client</h3>
        <p style="color: #9D9D9D; margin-bottom: 0px;">Client-780944f9-48cf-11ed-bfbf-3cecef1ac968</p>
        <table style="width: 100%; text-align: left;">

        <tr>

            <td style="text-align: left;"><strong>Connection method:</strong> Cluster object</td>
            <td style="text-align: left;"><strong>Cluster type:</strong> dask_jobqueue.PBSCluster</td>

        </tr>


            <tr>
                <td style="text-align: left;">
                    <strong>Dashboard: </strong> <a href="https://jupyterhub.hpc.ucar.edu/stable/user/mauricio/mrocha/proxy/8787/status" target="_blank">https://jupyterhub.hpc.ucar.edu/stable/user/mauricio/mrocha/proxy/8787/status</a>
                </td>
                <td style="text-align: left;"></td>
            </tr>


        </table>


            <details>
            <summary style="margin-bottom: 20px;"><h3 style="display: inline;">Cluster Info</h3></summary>
            <div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-mod-trusted jp-OutputArea-output">
    <div style="width: 24px; height: 24px; background-color: #e1e1e1; border: 3px solid #9D9D9D; border-radius: 5px; position: absolute;">
    </div>
    <div style="margin-left: 48px;">
        <h3 style="margin-bottom: 0px; margin-top: 0px;">PBSCluster</h3>
        <p style="color: #9D9D9D; margin-bottom: 0px;">f96a8e28</p>
        <table style="width: 100%; text-align: left;">
            <tr>
                <td style="text-align: left;">
                    <strong>Dashboard:</strong> <a href="https://jupyterhub.hpc.ucar.edu/stable/user/mauricio/mrocha/proxy/8787/status" target="_blank">https://jupyterhub.hpc.ucar.edu/stable/user/mauricio/mrocha/proxy/8787/status</a>
                </td>
                <td style="text-align: left;">
                    <strong>Workers:</strong> 0
                </td>
            </tr>
            <tr>
                <td style="text-align: left;">
                    <strong>Total threads:</strong> 0
                </td>
                <td style="text-align: left;">
                    <strong>Total memory:</strong> 0 B
                </td>
            </tr>

        </table>

        <details>
            <summary style="margin-bottom: 20px;">
                <h3 style="display: inline;">Scheduler Info</h3>
            </summary>

            <div style="">
    <div>
        <div style="width: 24px; height: 24px; background-color: #FFF7E5; border: 3px solid #FF6132; border-radius: 5px; position: absolute;"> </div>
        <div style="margin-left: 48px;">
            <h3 style="margin-bottom: 0px;">Scheduler</h3>
            <p style="color: #9D9D9D; margin-bottom: 0px;">Scheduler-63b4398d-e4bd-4b6e-965d-5aa6d9966825</p>
            <table style="width: 100%; text-align: left;">
                <tr>
                    <td style="text-align: left;">
                        <strong>Comm:</strong> tcp://10.12.206.61:44309
                    </td>
                    <td style="text-align: left;">
                        <strong>Workers:</strong> 0
                    </td>
                </tr>
                <tr>
                    <td style="text-align: left;">
                        <strong>Dashboard:</strong> <a href="https://jupyterhub.hpc.ucar.edu/stable/user/mauricio/mrocha/proxy/8787/status" target="_blank">https://jupyterhub.hpc.ucar.edu/stable/user/mauricio/mrocha/proxy/8787/status</a>
                    </td>
                    <td style="text-align: left;">
                        <strong>Total threads:</strong> 0
                    </td>
                </tr>
                <tr>
                    <td style="text-align: left;">
                        <strong>Started:</strong> Just now
                    </td>
                    <td style="text-align: left;">
                        <strong>Total memory:</strong> 0 B
                    </td>
                </tr>
            </table>
        </div>
    </div>

    <details style="margin-left: 48px;">
        <summary style="margin-bottom: 20px;">
            <h3 style="display: inline;">Workers</h3>
        </summary>



    </details>
</div>

        </details>
    </div>
</div>
            </details>


    </div>
</div></div></div>
</div>
<section id="read-in-ogcm-ssp370-file-moc-template-file">
<h2>Read in OGCM ssp370 file &amp; MOC template file<a class="headerlink" href="#read-in-ogcm-ssp370-file-moc-template-file" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">catalog</span> <span class="o">=</span> <span class="n">intake</span><span class="o">.</span><span class="n">open_esm_datastore</span><span class="p">(</span>
    <span class="s1">&#39;/glade/collections/cmip/catalog/intake-esm-datastore/catalogs/glade-cesm2-le.json&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/glade/u/home/mauricio/.local/lib/python3.8/site-packages/intake_esm/utils.py:96: DtypeWarning: Columns (5,6,9) have mixed types. Specify dtype option on import or set low_memory=False.
  return pd.read_csv(catalog_path, **csv_kwargs), catalog_path
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cat_subset</span> <span class="o">=</span> <span class="n">catalog</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">component</span><span class="o">=</span><span class="s1">&#39;ocn&#39;</span><span class="p">,</span><span class="n">variable</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;MOC&#39;</span><span class="p">],</span><span class="n">frequency</span><span class="o">=</span><span class="s1">&#39;month_1&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load catalog entries for subset into a dictionary of xarray datasets</span>
<span class="n">dset_dict_raw</span>  <span class="o">=</span> <span class="n">cat_subset</span><span class="o">.</span><span class="n">to_dataset_dict</span><span class="p">(</span><span class="n">zarr_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;consolidated&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span> <span class="n">storage_options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;anon&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Dataset dictionary keys:</span><span class="se">\n</span><span class="s1"> </span><span class="si">{</span><span class="n">dset_dict_raw</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--&gt; The keys in the returned dictionary of datasets are constructed as follows:
	&#39;component.experiment.stream.forcing_variant.variable&#39;
</pre></div>
</div>
<div class="output text_html">
<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div><div class="output text_html">
<div>
  <progress value='4' class='' max='4' style='width:300px; height:20px; vertical-align: middle;'></progress>
  100.00% [4/4 00:25&lt;00:00]
</div>
</div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dataset dictionary keys:
 dict_keys([&#39;ocn.historical.pop.h.cmip6.MOC&#39;, &#39;ocn.ssp370.pop.h.cmip6.MOC&#39;, &#39;ocn.historical.pop.h.smbb.MOC&#39;, &#39;ocn.ssp370.pop.h.smbb.MOC&#39;])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">fb</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;cmip6&#39;</span><span class="p">,</span><span class="s1">&#39;smbb&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ifb</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Forcing_variant: </span><span class="si">{</span><span class="n">ifb</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">str</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;ds_</span><span class="si">{</span><span class="n">fb</span><span class="p">[</span><span class="n">ifb</span><span class="p">]</span><span class="si">}</span><span class="s1">_moc = dset_dict_raw[</span><span class="se">\&#39;</span><span class="s1">ocn.ssp370.pop.h.</span><span class="si">{</span><span class="n">fb</span><span class="p">[</span><span class="n">ifb</span><span class="p">]</span><span class="si">}</span><span class="s1">.MOC</span><span class="se">\&#39;</span><span class="s1">]&#39;</span> 
    <span class="n">exec</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="nb">str</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;ds_</span><span class="si">{</span><span class="n">fb</span><span class="p">[</span><span class="n">ifb</span><span class="p">]</span><span class="si">}</span><span class="s1">_moc = ds_</span><span class="si">{</span><span class="n">fb</span><span class="p">[</span><span class="n">ifb</span><span class="p">]</span><span class="si">}</span><span class="s1">_moc.sel(time=slice(</span><span class="se">\&#39;</span><span class="s1">2015-02-01</span><span class="se">\&#39;</span><span class="s1">, </span><span class="se">\&#39;</span><span class="s1">2100-12-31</span><span class="se">\&#39;</span><span class="s1">))&#39;</span> <span class="c1"># Time Series</span>
    <span class="n">exec</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="nb">str</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;ds_</span><span class="si">{</span><span class="n">fb</span><span class="p">[</span><span class="n">ifb</span><span class="p">]</span><span class="si">}</span><span class="s1">_moc = ds_</span><span class="si">{</span><span class="n">fb</span><span class="p">[</span><span class="n">ifb</span><span class="p">]</span><span class="si">}</span><span class="s1">_moc.resample(time=</span><span class="se">\&#39;</span><span class="s1">1Y</span><span class="se">\&#39;</span><span class="s1">, closed=</span><span class="se">\&#39;</span><span class="s1">left</span><span class="se">\&#39;</span><span class="s1">).mean(</span><span class="se">\&#39;</span><span class="s1">time</span><span class="se">\&#39;</span><span class="s1">)&#39;</span> <span class="c1"># Yearly average</span>
    <span class="n">exec</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="nb">str</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;moc_</span><span class="si">{</span><span class="n">fb</span><span class="p">[</span><span class="n">ifb</span><span class="p">]</span><span class="si">}</span><span class="s1"> = ds_</span><span class="si">{</span><span class="n">fb</span><span class="p">[</span><span class="n">ifb</span><span class="p">]</span><span class="si">}</span><span class="s1">_moc[</span><span class="se">\&#39;</span><span class="s1">MOC</span><span class="se">\&#39;</span><span class="s1">]&#39;</span> <span class="c1"># Variable</span>
    <span class="n">exec</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="nb">str</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;moc_</span><span class="si">{</span><span class="n">fb</span><span class="p">[</span><span class="n">ifb</span><span class="p">]</span><span class="si">}</span><span class="s1">[</span><span class="se">\&#39;</span><span class="s1">moc_z</span><span class="se">\&#39;</span><span class="s1">] = -0.01*moc_</span><span class="si">{</span><span class="n">fb</span><span class="p">[</span><span class="n">ifb</span><span class="p">]</span><span class="si">}</span><span class="s1">.moc_z&#39;</span> <span class="c1"># cm to m and negative depth</span>
    <span class="n">exec</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Forcing_variant: 0
Forcing_variant: 1
CPU times: user 4.66 s, sys: 24.8 ms, total: 4.68 s
Wall time: 4.84 s
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds_moc</span><span class="o">=</span><span class="n">xr</span><span class="o">.</span><span class="n">combine_nested</span><span class="p">([</span><span class="n">moc_cmip6</span><span class="p">,</span><span class="n">moc_smbb</span><span class="p">],</span><span class="n">concat_dim</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;member_id&#39;</span><span class="p">]);</span> <span class="k">del</span> <span class="n">moc_cmip6</span><span class="p">,</span> <span class="n">moc_smbb</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Z1</span> <span class="o">=</span> <span class="n">ds_moc</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">transport_reg</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="s1">&#39;2020-01-01&#39;</span><span class="p">,</span><span class="s1">&#39;2030-01-01&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;member_id&#39;</span><span class="p">,</span><span class="s1">&#39;time&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;moc_comp&#39;</span><span class="p">)</span>
<span class="n">Z2</span> <span class="o">=</span> <span class="n">ds_moc</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">transport_reg</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="s1">&#39;2080-01-01&#39;</span><span class="p">,</span><span class="s1">&#39;2090-01-01&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;member_id&#39;</span><span class="p">,</span><span class="s1">&#39;time&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;moc_comp&#39;</span><span class="p">)</span>
<span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">ds_moc</span><span class="p">[</span><span class="s1">&#39;lat_aux_grid&#39;</span><span class="p">],</span><span class="n">ds_moc</span><span class="p">[</span><span class="s1">&#39;moc_z&#39;</span><span class="p">])</span>
<span class="n">mn</span><span class="o">=-</span><span class="mi">20</span>
<span class="n">mx</span><span class="o">=</span><span class="mi">20</span>
<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">17</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>

<span class="n">im1</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z1</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">mn</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">mx</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;RdBu_r&quot;</span><span class="p">)</span>

<span class="n">axins</span> <span class="o">=</span> <span class="n">inset_axes</span><span class="p">(</span><span class="n">ax2</span><span class="p">,</span>
                   <span class="n">width</span><span class="o">=</span><span class="s2">&quot;5%&quot;</span><span class="p">,</span>  <span class="c1"># width = 5% of parent_bbox width</span>
                   <span class="n">height</span><span class="o">=</span><span class="s2">&quot;100%&quot;</span><span class="p">,</span>  <span class="c1"># height : 50%</span>
                   <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower left&#39;</span><span class="p">,</span>
                   <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                   <span class="n">bbox_transform</span><span class="o">=</span><span class="n">ax2</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
                   <span class="n">borderpad</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                   <span class="p">)</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z2</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">mn</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">mx</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;RdBu_r&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">axins</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="n">mn</span><span class="p">,</span> <span class="n">mx</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Sv&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z1</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">,),</span> <span class="n">linestyles</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;--&#39;</span><span class="p">,),</span> <span class="n">linewidths</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z2</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">,),</span> <span class="n">linestyles</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;--&#39;</span><span class="p">,),</span> <span class="n">linewidths</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;2020-2030&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;2080-2090&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Latitude&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Latitude&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Depth [m]&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">33.008255</span><span class="p">,</span><span class="mi">80</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">33.008255</span><span class="p">,</span><span class="mi">80</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/Notebook_lens2_ssp370_MOC_upper_branch_11_0.png" src="_images/Notebook_lens2_ssp370_MOC_upper_branch_11_0.png" />
</div>
</div>
<div class="alert alert-block alert-info">
<b>Note:</b> Notice that we limited the southernmost latitude (34.34514005S) so that we could use the mask that covers the Atlantic
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax3</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span> 
<span class="n">cs1</span> <span class="o">=</span> <span class="n">ax3</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Z2</span><span class="p">)</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">Z1</span><span class="p">),</span> <span class="mi">20</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">8</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;coolwarm&quot;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Z2</span><span class="p">)</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">Z1</span><span class="p">),</span> <span class="n">levels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">,),</span> <span class="n">linestyles</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;--&#39;</span><span class="p">,),</span> <span class="n">linewidths</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;(2080-2090)-(2020-2030)&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Latitude&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Depth [m]&#39;</span><span class="p">)</span> 
<span class="n">ax3</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">33.008255</span><span class="p">,</span><span class="mi">80</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cs1</span><span class="p">,</span><span class="n">ticks</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Sv&#39;</span><span class="p">)</span>
<span class="c1">#plt.colorbar(cs1,ticks=range(-10, 10),label=&#39;Sv&#39;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/Notebook_lens2_ssp370_MOC_upper_branch_13_0.png" src="_images/Notebook_lens2_ssp370_MOC_upper_branch_13_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Z1</span> <span class="o">=</span> <span class="n">ds_moc</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">transport_reg</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">lat_aux_grid</span><span class="o">=</span><span class="mi">87</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;member_id&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;moc_comp&#39;</span><span class="p">)</span>
<span class="n">Z1_max</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Z1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">)[</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="c1"># I chose a region of maximum, selecting the fourth maximum value of all the years</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">Z1_max</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>

<span class="n">Z2</span> <span class="o">=</span> <span class="n">ds_moc</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">transport_reg</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">lat_aux_grid</span><span class="o">=</span><span class="mi">146</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;member_id&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;moc_comp&#39;</span><span class="p">)</span>
<span class="n">Z2_max</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Z2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">)[</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">Z2_max</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>

<span class="n">Z3</span> <span class="o">=</span> <span class="n">ds_moc</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">transport_reg</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">lat_aux_grid</span><span class="o">=</span><span class="mi">274</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;member_id&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;moc_comp&#39;</span><span class="p">)</span>
<span class="n">Z3_max</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Z3</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">)[</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">Z3_max</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>

<span class="n">Z4</span> <span class="o">=</span> <span class="n">ds_moc</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">transport_reg</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">lat_aux_grid</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;member_id&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;moc_comp&#39;</span><span class="p">)</span>
<span class="n">Z4_max</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Z4</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">)[</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">Z4_max</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>

<span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">ds_moc</span><span class="p">[</span><span class="s1">&#39;moc_z&#39;</span><span class="p">],</span><span class="n">ds_moc</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>18.4
17.4
17.4
20.7
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="c1">#Figure</span>
<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">,</span> <span class="n">ax4</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">17</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z1</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">mn</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">mx</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;RdBu_r&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z2</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">mn</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">mx</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;RdBu_r&quot;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z3</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">mn</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">mx</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;RdBu_r&quot;</span><span class="p">)</span>

<span class="n">im</span> <span class="o">=</span> <span class="n">ax4</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z4</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">mn</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">mx</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;RdBu_r&quot;</span><span class="p">)</span>
<span class="n">axins</span> <span class="o">=</span> <span class="n">inset_axes</span><span class="p">(</span><span class="n">ax4</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="s1">&#39;5%&#39;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="s1">&#39;100%&#39;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">bbox_transform</span><span class="o">=</span><span class="n">ax4</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">borderpad</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">axins</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="n">mn</span><span class="p">,</span> <span class="n">mx</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Sv&#39;</span><span class="p">)</span>

<span class="c1"># Subplots</span>
<span class="n">fmax</span><span class="o">=</span><span class="mi">10</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z1</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">,),</span> <span class="n">linestyles</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;--&#39;</span><span class="p">,),</span> <span class="n">linewidths</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,));</span> <span class="n">CS</span><span class="o">=</span><span class="n">ax1</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z1</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="p">[</span><span class="mf">18.4</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">,),</span> <span class="n">linestyles</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,),</span> <span class="n">linewidths</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">CS</span><span class="p">,</span> <span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fmax</span><span class="p">);</span> <span class="k">del</span> <span class="n">CS</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z2</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">,),</span> <span class="n">linestyles</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;--&#39;</span><span class="p">,),</span> <span class="n">linewidths</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,));</span> <span class="n">CS</span><span class="o">=</span><span class="n">ax2</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z2</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="p">[</span><span class="mf">17.4</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">,),</span> <span class="n">linestyles</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,),</span> <span class="n">linewidths</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,))</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">CS</span><span class="p">,</span> <span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fmax</span><span class="p">);</span> <span class="k">del</span> <span class="n">CS</span>

<span class="n">ax3</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z3</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">,),</span> <span class="n">linestyles</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;--&#39;</span><span class="p">,),</span> <span class="n">linewidths</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,));</span> <span class="n">CS</span><span class="o">=</span><span class="n">ax3</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z3</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="p">[</span><span class="mf">17.4</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">,),</span> <span class="n">linestyles</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,),</span> <span class="n">linewidths</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,))</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">CS</span><span class="p">,</span> <span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fmax</span><span class="p">);</span> <span class="k">del</span> <span class="n">CS</span>

<span class="n">ax4</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z4</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">,),</span> <span class="n">linestyles</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;--&#39;</span><span class="p">,),</span> <span class="n">linewidths</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,));</span> <span class="n">CS</span><span class="o">=</span><span class="n">ax4</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z4</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="p">[</span><span class="mf">20.4</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">,),</span> <span class="n">linestyles</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,),</span> <span class="n">linewidths</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,))</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">CS</span><span class="p">,</span> <span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fmax</span><span class="p">);</span> <span class="k">del</span> <span class="n">CS</span>

<span class="c1">#Labels</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;-33.008255S (SAMOC-34.5S)&#39;</span><span class="p">);</span> <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;-10.9519205S (11S)&#39;</span><span class="p">);</span> <span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;26.273556N (RAPID)&#39;</span><span class="p">);</span> <span class="n">ax4</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;39.953373N (AMOC Maxima)&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Depth [m]&#39;</span><span class="p">);</span> <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Depth [m]&#39;</span><span class="p">);</span> <span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Depth [m]&#39;</span><span class="p">);</span> <span class="n">ax4</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Depth [m]&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Time [Years]&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.7</span><span class="p">);</span> <span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.7</span><span class="p">);</span> <span class="n">ax3</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.7</span><span class="p">);</span> <span class="n">ax4</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/Notebook_lens2_ssp370_MOC_upper_branch_15_0.png" src="_images/Notebook_lens2_ssp370_MOC_upper_branch_15_0.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 2min 47s, sys: 2.62 s, total: 2min 50s
Wall time: 3min 4s
</pre></div>
</div>
</div>
</div>
<div class="alert alert-block alert-info">
<b>Note:</b> Can we say that the weakening in the South Atlantic is faster than in other basins? The South Atlantic is the warmest basin and this may not be by chance. </section>
<section id="let-s-read-the-data-again-since-we-need-a-monthly-series">
<h2>Let’s read the data again since we need a monthly series<a class="headerlink" href="#let-s-read-the-data-again-since-we-need-a-monthly-series" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fb</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;cmip6&#39;</span><span class="p">,</span><span class="s1">&#39;smbb&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ifb</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Forcing_variant: </span><span class="si">{</span><span class="n">ifb</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">str</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;ds_</span><span class="si">{</span><span class="n">fb</span><span class="p">[</span><span class="n">ifb</span><span class="p">]</span><span class="si">}</span><span class="s1">_moc = dset_dict_raw[</span><span class="se">\&#39;</span><span class="s1">ocn.ssp370.pop.h.</span><span class="si">{</span><span class="n">fb</span><span class="p">[</span><span class="n">ifb</span><span class="p">]</span><span class="si">}</span><span class="s1">.MOC</span><span class="se">\&#39;</span><span class="s1">]&#39;</span> 
    <span class="n">exec</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="nb">str</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;ds_</span><span class="si">{</span><span class="n">fb</span><span class="p">[</span><span class="n">ifb</span><span class="p">]</span><span class="si">}</span><span class="s1">_moc = ds_</span><span class="si">{</span><span class="n">fb</span><span class="p">[</span><span class="n">ifb</span><span class="p">]</span><span class="si">}</span><span class="s1">_moc.sel(time=slice(</span><span class="se">\&#39;</span><span class="s1">2009-01-01</span><span class="se">\&#39;</span><span class="s1">, </span><span class="se">\&#39;</span><span class="s1">2014-12-31</span><span class="se">\&#39;</span><span class="s1">))&#39;</span> <span class="c1"># Time Series</span>
    <span class="n">exec</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="nb">str</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;ds_</span><span class="si">{</span><span class="n">fb</span><span class="p">[</span><span class="n">ifb</span><span class="p">]</span><span class="si">}</span><span class="s1">_moc[</span><span class="se">\&#39;</span><span class="s1">moc_z</span><span class="se">\&#39;</span><span class="s1">] = -0.01*ds_</span><span class="si">{</span><span class="n">fb</span><span class="p">[</span><span class="n">ifb</span><span class="p">]</span><span class="si">}</span><span class="s1">_moc[</span><span class="se">\&#39;</span><span class="s1">moc_z</span><span class="se">\&#39;</span><span class="s1">]&#39;</span> <span class="c1"># cm to m and negative depth</span>
    <span class="n">exec</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="nb">str</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;ds_</span><span class="si">{</span><span class="n">fb</span><span class="p">[</span><span class="n">ifb</span><span class="p">]</span><span class="si">}</span><span class="s1">_moc[</span><span class="se">\&#39;</span><span class="s1">dz</span><span class="se">\&#39;</span><span class="s1">] = 0.01*ds_</span><span class="si">{</span><span class="n">fb</span><span class="p">[</span><span class="n">ifb</span><span class="p">]</span><span class="si">}</span><span class="s1">_moc[</span><span class="se">\&#39;</span><span class="s1">dz</span><span class="se">\&#39;</span><span class="s1">]&#39;</span> <span class="c1"># cm to m and negative depth</span>
    <span class="n">exec</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds_moc</span><span class="o">=</span><span class="n">xr</span><span class="o">.</span><span class="n">combine_nested</span><span class="p">([</span><span class="n">ds_cmip6_moc</span><span class="p">,</span><span class="n">ds_smbb_moc</span><span class="p">],</span><span class="n">concat_dim</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;member_id&#39;</span><span class="p">]);</span> <span class="k">del</span> <span class="n">ds_cmip6_moc</span><span class="p">;</span> <span class="k">del</span> <span class="n">ds_smbb_moc</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="what-does-the-vertical-profile-of-amoc-look-like">
<h2>What does the vertical profile of AMOC look like?<a class="headerlink" href="#what-does-the-vertical-profile-of-amoc-look-like" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ila</span><span class="o">=</span><span class="mi">87</span>
<span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span>
<span class="n">moc_mean</span><span class="o">=</span><span class="n">ds_moc</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">transport_reg</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">lat_aux_grid</span><span class="o">=</span><span class="n">ila</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;moc_comp&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
<span class="n">moc_mean</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;moc_z&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">add_legend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">moc_mean</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;member_id&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;moc_z&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;LENS2&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Volume Transport [Sv]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Depth [m]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;AMOC at 33.008255S [ssp370: 2009-01 to 2014-12]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">bbox_props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;0.5&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<section id="interpolate-to-create-moc-data-in-the-middle-of-the-layer">
<h3>Interpolate to create MOC data in the middle of the layer<a class="headerlink" href="#interpolate-to-create-moc-data-in-the-middle-of-the-layer" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ila</span><span class="o">=</span><span class="mi">87</span>
<span class="n">prof</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">ds_moc</span><span class="p">[</span><span class="s1">&#39;moc_z&#39;</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">ds_moc</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;moc_z&#39;</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span> 
        <span class="n">prof</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">ds_moc</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;moc_z&#39;</span><span class="p">][</span><span class="n">t</span><span class="p">]</span><span class="o">+</span><span class="n">ds_moc</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;moc_z&#39;</span><span class="p">][</span><span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span> 
<span class="n">ds_moc</span><span class="o">.</span><span class="n">MOC</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">moc_z</span><span class="o">=</span><span class="n">prof</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">member_id</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">transport_reg</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">lat_aux_grid</span><span class="o">=</span><span class="n">ila</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;moc_comp&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">ds_moc</span><span class="o">.</span><span class="n">MOC</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">member_id</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">transport_reg</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">lat_aux_grid</span><span class="o">=</span><span class="n">ila</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;moc_comp&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">ds_moc_int</span><span class="o">=</span><span class="n">ds_moc</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">moc_z</span><span class="o">=</span><span class="n">prof</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">y_int</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">ds_moc_int</span><span class="p">[</span><span class="s1">&#39;member_id&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">ds_moc</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">ds_moc_int</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])):</span> <span class="c1"># time </span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Time: </span><span class="si">{</span><span class="n">it</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">amoc</span> <span class="o">=</span> <span class="n">ds_moc_int</span><span class="o">.</span><span class="n">MOC</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">it</span><span class="p">,</span><span class="n">transport_reg</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">lat_aux_grid</span><span class="o">=</span><span class="n">ila</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;moc_comp&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">im</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">):</span> <span class="c1"># members (50 member in total)</span>
    <span class="c1">#for im in range(0,len(ds_moc_int[&#39;member_id&#39;])): # members (50 member in total)</span>
        <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">amoc</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">member_id</span><span class="o">=</span><span class="n">im</span><span class="p">,</span><span class="n">moc_z</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">46</span><span class="p">,</span><span class="mi">61</span><span class="p">))</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># Notes: 40=-1041.3682m; 60=-5499.9907m</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">amoc</span><span class="p">[</span><span class="s1">&#39;moc_z&#39;</span><span class="p">][</span><span class="n">L</span><span class="p">])</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="c1"># If there is no negative transport in this interval (moc_z=slice(46,61)), the integral is done from surface to bottom.     </span>
            <span class="c1">#y_int[it,im,ifb]=sum(amoc.isel(member_id=im,moc_z=slice(0,-1))*(amoc.isel(member_id=im)[&#39;moc_z&#39;][0:-1].diff(&quot;moc_z&quot;)))/sum(amoc.isel(member_id=im)[&#39;moc_z&#39;][0:-1].diff(&quot;moc_z&quot;))</span>
            <span class="n">y_int</span><span class="p">[</span><span class="n">im</span><span class="p">,</span><span class="n">it</span><span class="p">]</span><span class="o">=</span><span class="nb">sum</span><span class="p">(</span><span class="n">amoc</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">member_id</span><span class="o">=</span><span class="n">im</span><span class="p">)</span><span class="o">*</span><span class="n">ds_moc</span><span class="o">.</span><span class="n">dz</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">member_id</span><span class="o">=</span><span class="n">im</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">ds_moc</span><span class="o">.</span><span class="n">dz</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">member_id</span><span class="o">=</span><span class="n">im</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#y_int[it,im,ifb]=sum(amoc.isel(member_id=im,moc_z=slice(0,L[0][0]-1+46))*(amoc.isel(member_id=im)[&#39;moc_z&#39;][0:L[0][0]-1+46].diff(&#39;moc_z&#39;)))/sum(amoc.isel(member_id=im)[&#39;moc_z&#39;][0:L[0][0]-1+46].diff(&#39;moc_z&#39;))</span>
            <span class="n">y_int</span><span class="p">[</span><span class="n">im</span><span class="p">,</span><span class="n">it</span><span class="p">]</span><span class="o">=</span><span class="nb">sum</span><span class="p">(</span><span class="n">amoc</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">member_id</span><span class="o">=</span><span class="n">im</span><span class="p">,</span><span class="n">moc_z</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">L</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="o">+</span><span class="mi">46</span><span class="p">))</span><span class="o">*</span><span class="n">ds_moc</span><span class="o">.</span><span class="n">dz</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">member_id</span><span class="o">=</span><span class="n">im</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="n">L</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="o">+</span><span class="mi">46</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">ds_moc</span><span class="o">.</span><span class="n">dz</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">member_id</span><span class="o">=</span><span class="n">im</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="n">L</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="o">+</span><span class="mi">46</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds_MOC_SAMOC</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">({</span><span class="s1">&#39;MOC_SAMOC&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s1">&#39;member_id&#39;</span><span class="p">,</span><span class="s1">&#39;time&#39;</span><span class="p">),</span> <span class="n">y_int</span><span class="p">)},</span><span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;member_id&#39;</span><span class="p">:</span> <span class="n">ds_moc</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;member_id&#39;</span><span class="p">],</span><span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="n">ds_moc</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]})</span>
<span class="n">ds_MOC_SAMOC</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Meridional Overturning Circulation (MOC) upper branch from the surface to the level where the transport volume reverses sign for the period from 2009 to 2014&#39;</span>
<span class="n">ds_MOC_SAMOC</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Sv&#39;</span>
<span class="n">ds_MOC_SAMOC</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;author&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Mauricio Rocha&#39;</span>
<span class="n">ds_MOC_SAMOC</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;mauricio.rocha@usp.br&#39;</span>
<span class="n">ds_MOC_SAMOC</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds_MOC_SAMOC</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create a directory on scratch to save the output</span>
<span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;/glade/scratch/mauricio/LENS2_ssp370_south_atlantic/MOC_SAMOC/&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">getpass</span><span class="o">.</span><span class="n">getuser</span><span class="p">())</span>
<span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;mkdir -p &#39;</span><span class="o">+</span><span class="n">path</span><span class="p">)</span>
<span class="n">ds_MOC_SAMOC</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="s1">&#39;MOC_SAMOC.nc&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "npl-2022b"
        },
        kernelOptions: {
            kernelName: "npl-2022b",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'npl-2022b'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="Notebook_lens2_historical_MOC_upper_branch.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">CESM2 - LARGE ENSEMBLE (LENS2)</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="Notebook_South_Atlantic_plots_temporal_series_historical.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">CESM2 - LARGE ENSEMBLE (LENS2)</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By NCAR ESDS Team<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>