
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Compute MOCfor the CMEMS Reanalysis &#8212; Analysis Project Template</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Build masks" href="south_atlantic_maks_gx1v7.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Analysis Project Template</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Introduction
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="Notebook_Notes.html">
   CESM2 - LARGE ENSEMBLE (LENS2)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Notebook_South_Atlantic_Area.html">
   CESM2 - LARGE ENSEMBLE (LENS2)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Notebook_South_Atlantic_Surface_Analyses_ocn_comp_historical.html">
   CESM2 - LARGE ENSEMBLE (LENS2)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Notebook_South_Atlantic_Surface_Analyses_ocn_comp_ssp370.html">
   CESM2 - LARGE ENSEMBLE (LENS2)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Notebook_South_Atlantic_Surface_Analyses_atm_comp_historical.html">
   CESM2 - LARGE ENSEMBLE (LENS2)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Notebook_South_Atlantic_Surface_Analyses_atm_comp_ssp370.html">
   CESM2 - LARGE ENSEMBLE (LENS2)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Notebook_lens2_historical_MOCz_maxima.html">
   CESM2 - LARGE ENSEMBLE (LENS2)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Notebook_lens2_ssp370_MOCz_maxima.html">
   CESM2 - LARGE ENSEMBLE (LENS2)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Notebook_lens2_MOCsig2_1deg.html">
   CESM2 - LARGE ENSEMBLE (LENS2)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Notebook_lens2_historical_MOC_upper_branch.html">
   CESM2 - LARGE ENSEMBLE (LENS2)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Notebook_lens2_ssp370_MOC_upper_branch.html">
   CESM2 - LARGE ENSEMBLE (LENS2)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Notebook_South_Atlantic_plots_temporal_series_historical.html">
   CESM2 - LARGE ENSEMBLE (LENS2)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Notebook_ascii_netcdf.html">
   CESM2 - LARGE ENSEMBLE (LENS2)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Notebook_North_Atlantic_XMXL_hovmoller_diagrams_historical.html">
   CESM2 - LARGE ENSEMBLE (LENS2)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="south_atlantic_maks_gx1v7.html">
   Build masks
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Compute MOCfor the CMEMS Reanalysis
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/glorys2v2_moc.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="_sources/glorys2v2_moc.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Compute MOCfor the CMEMS Reanalysis
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#read-in-ogcm-history-files">
   1. Read in OGCM history files
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#build-grid">
   2. Build grid
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#generate-basin-masks">
   Generate basin masks
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#volume-fluxes-and-moc">
   3. Volume fluxes and MOC
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#moc">
   MOC
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#amoc">
   AMOC
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#monthly-time-series-of-maximum-transport-at-34-5">
   Monthly time series of maximum transport at -34.5
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#amoc-depth-profile">
   AMOC depth profile
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Compute MOCfor the CMEMS Reanalysis</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Compute MOCfor the CMEMS Reanalysis
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#read-in-ogcm-history-files">
   1. Read in OGCM history files
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#build-grid">
   2. Build grid
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#generate-basin-masks">
   Generate basin masks
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#volume-fluxes-and-moc">
   3. Volume fluxes and MOC
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#moc">
   MOC
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#amoc">
   AMOC
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#monthly-time-series-of-maximum-transport-at-34-5">
   Monthly time series of maximum transport at -34.5
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#amoc-depth-profile">
   AMOC depth profile
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section id="compute-mocfor-the-cmems-reanalysis">
<h1>Compute MOCfor the CMEMS Reanalysis<a class="headerlink" href="#compute-mocfor-the-cmems-reanalysis" title="Permalink to this headline">#</a></h1>
<p><a class="reference external" href="https://resources.marine.copernicus.eu/product-detail/GLOBAL_REANALYSIS_PHY_001_031/INFORMATION">https://resources.marine.copernicus.eu/product-detail/GLOBAL_REANALYSIS_PHY_001_031/INFORMATION</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span> 
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>  
<span class="kn">import</span> <span class="nn">cftime</span>
<span class="kn">from</span> <span class="nn">xhistogram.xarray</span> <span class="kn">import</span> <span class="n">histogram</span>
<span class="kn">from</span> <span class="nn">geopy.distance</span> <span class="kn">import</span> <span class="n">great_circle</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">metpy.calc</span> <span class="kn">import</span> <span class="n">lat_lon_grid_deltas</span>
<span class="kn">import</span> <span class="nn">distributed</span>
<span class="kn">import</span> <span class="nn">ncar_jobqueue</span>
<span class="kn">from</span> <span class="nn">mom6_tools.m6toolbox</span> <span class="kn">import</span> <span class="n">genBasinMasks</span> 
<span class="kn">from</span> <span class="nn">mom6_tools.m6plot</span> <span class="kn">import</span> <span class="n">xyplot</span>
<span class="kn">from</span> <span class="nn">mom6_tools</span> <span class="kn">import</span> <span class="n">m6plot</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cluster</span> <span class="o">=</span> <span class="n">ncar_jobqueue</span><span class="o">.</span><span class="n">NCARCluster</span><span class="p">()</span>

<span class="n">cluster</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">distributed</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">cluster</span><span class="p">)</span>
<span class="n">client</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/glade/work/gmarques/miniconda/envs/dev2/lib/python3.9/site-packages/distributed/node.py:160: UserWarning: Port 8787 is already in use.
Perhaps you already have a cluster running?
Hosting the HTTP server on port 42052 instead
  warnings.warn(
</pre></div>
</div>
<div class="output text_html"><div>
    <div style="width: 24px; height: 24px; background-color: #e1e1e1; border: 3px solid #9D9D9D; border-radius: 5px; position: absolute;"> </div>
    <div style="margin-left: 48px;">
        <h3 style="margin-bottom: 0px;">Client</h3>
        <p style="color: #9D9D9D; margin-bottom: 0px;">Client-36df0eb3-6458-11ed-b563-3cecef1b11e4</p>
        <table style="width: 100%; text-align: left;">

        <tr>

            <td style="text-align: left;"><strong>Connection method:</strong> Cluster object</td>
            <td style="text-align: left;"><strong>Cluster type:</strong> dask_jobqueue.PBSCluster</td>

        </tr>


            <tr>
                <td style="text-align: left;">
                    <strong>Dashboard: </strong> <a href="https://jupyterhub.hpc.ucar.edu/stable/user/gmarques/highmem/proxy/42052/status" target="_blank">https://jupyterhub.hpc.ucar.edu/stable/user/gmarques/highmem/proxy/42052/status</a>
                </td>
                <td style="text-align: left;"></td>
            </tr>


        </table>


            <details>
            <summary style="margin-bottom: 20px;"><h3 style="display: inline;">Cluster Info</h3></summary>
            <div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-mod-trusted jp-OutputArea-output">
    <div style="width: 24px; height: 24px; background-color: #e1e1e1; border: 3px solid #9D9D9D; border-radius: 5px; position: absolute;">
    </div>
    <div style="margin-left: 48px;">
        <h3 style="margin-bottom: 0px; margin-top: 0px;">PBSCluster</h3>
        <p style="color: #9D9D9D; margin-bottom: 0px;">4f6b5122</p>
        <table style="width: 100%; text-align: left;">
            <tr>
                <td style="text-align: left;">
                    <strong>Dashboard:</strong> <a href="https://jupyterhub.hpc.ucar.edu/stable/user/gmarques/highmem/proxy/42052/status" target="_blank">https://jupyterhub.hpc.ucar.edu/stable/user/gmarques/highmem/proxy/42052/status</a>
                </td>
                <td style="text-align: left;">
                    <strong>Workers:</strong> 0
                </td>
            </tr>
            <tr>
                <td style="text-align: left;">
                    <strong>Total threads:</strong> 0
                </td>
                <td style="text-align: left;">
                    <strong>Total memory:</strong> 0 B
                </td>
            </tr>

        </table>

        <details>
            <summary style="margin-bottom: 20px;">
                <h3 style="display: inline;">Scheduler Info</h3>
            </summary>

            <div style="">
    <div>
        <div style="width: 24px; height: 24px; background-color: #FFF7E5; border: 3px solid #FF6132; border-radius: 5px; position: absolute;"> </div>
        <div style="margin-left: 48px;">
            <h3 style="margin-bottom: 0px;">Scheduler</h3>
            <p style="color: #9D9D9D; margin-bottom: 0px;">Scheduler-354f901e-0ccd-4e32-b143-e1decdc16c36</p>
            <table style="width: 100%; text-align: left;">
                <tr>
                    <td style="text-align: left;">
                        <strong>Comm:</strong> tcp://10.12.206.57:35908
                    </td>
                    <td style="text-align: left;">
                        <strong>Workers:</strong> 0
                    </td>
                </tr>
                <tr>
                    <td style="text-align: left;">
                        <strong>Dashboard:</strong> <a href="https://jupyterhub.hpc.ucar.edu/stable/user/gmarques/highmem/proxy/42052/status" target="_blank">https://jupyterhub.hpc.ucar.edu/stable/user/gmarques/highmem/proxy/42052/status</a>
                    </td>
                    <td style="text-align: left;">
                        <strong>Total threads:</strong> 0
                    </td>
                </tr>
                <tr>
                    <td style="text-align: left;">
                        <strong>Started:</strong> Just now
                    </td>
                    <td style="text-align: left;">
                        <strong>Total memory:</strong> 0 B
                    </td>
                </tr>
            </table>
        </div>
    </div>

    <details style="margin-left: 48px;">
        <summary style="margin-bottom: 20px;">
            <h3 style="display: inline;">Workers</h3>
        </summary>



    </details>
</div>

        </details>
    </div>
</div>
            </details>


    </div>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#cluster.close()</span>
<span class="c1">#client.close()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">weighted_temporal_mean</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">var</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    weight by days in each month</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Determine the month length</span>
    <span class="n">month_length</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">days_in_month</span>

    <span class="c1"># Calculate the weights</span>
    <span class="n">wgts</span> <span class="o">=</span> <span class="n">month_length</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;time.year&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="n">month_length</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;time.year&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

    <span class="c1"># Make sure the weights in each year add up to 1</span>
    <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_allclose</span><span class="p">(</span><span class="n">wgts</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;time.year&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">xr</span><span class="o">.</span><span class="n">ALL_DIMS</span><span class="p">),</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="c1"># Subset our dataset for our variable</span>
    <span class="n">obs</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="n">var</span><span class="p">]</span>

    <span class="c1"># Setup our masking for nan values</span>
    <span class="n">cond</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span>
    <span class="n">ones</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="c1"># Calculate the numerator</span>
    <span class="n">obs_sum</span> <span class="o">=</span> <span class="p">(</span><span class="n">obs</span> <span class="o">*</span> <span class="n">wgts</span><span class="p">)</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s2">&quot;AS&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>

    <span class="c1"># Calculate the denominator</span>
    <span class="n">ones_out</span> <span class="o">=</span> <span class="p">(</span><span class="n">ones</span> <span class="o">*</span> <span class="n">wgts</span><span class="p">)</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s2">&quot;AS&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>

    <span class="c1"># Return the weighted average</span>
    <span class="k">return</span> <span class="n">obs_sum</span> <span class="o">/</span> <span class="n">ones_out</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="read-in-ogcm-history-files">
<h1>1. Read in OGCM history files<a class="headerlink" href="#read-in-ogcm-history-files" title="Permalink to this headline">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;/glade/scratch/gmarques/glorys2v4/&#39;</span>
<span class="n">ds_mon</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">ds</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">models</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;glor&#39;</span><span class="p">,</span><span class="s1">&#39;foam&#39;</span><span class="p">,</span><span class="s1">&#39;cglo&#39;</span><span class="p">,</span><span class="s1">&#39;oras&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">models</span><span class="p">:</span>
  <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_*_??.nc&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
  <span class="n">ds1</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_mfdataset</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="n">fname</span><span class="p">,</span> <span class="n">parallel</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
  <span class="n">vname</span> <span class="o">=</span> <span class="s1">&#39;vo_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
  <span class="n">ds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ds1</span><span class="p">[</span><span class="n">vname</span><span class="p">])</span>
  <span class="c1">#ds2 = weighted_temporal_mean(ds1, vname)</span>
  <span class="c1">#ds.append(ds2)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="build-grid">
<h1>2. Build grid<a class="headerlink" href="#build-grid" title="Permalink to this headline">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># calculate dx and dy, this is an approximation - this function is very fast compared to other ways of </span>
<span class="c1"># calculating dx</span>
<span class="n">dx_tmp</span><span class="p">,</span> <span class="n">dy_tmp</span> <span class="o">=</span> <span class="n">lat_lon_grid_deltas</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">longitude</span><span class="p">,</span> <span class="n">ds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">latitude</span><span class="p">)</span>
<span class="c1"># convert from pint.util.Quantity to numpy ndarray</span>
<span class="n">dx_tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dx_tmp</span><span class="p">)</span> <span class="c1"># in m</span>
<span class="n">dy_tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dy_tmp</span><span class="p">)</span> <span class="c1"># in m</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,:]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">dy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,:]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="c1"># dx</span>
<span class="c1"># the grid is already on the corner points, we will approximate dx in the last </span>
<span class="c1"># column im using values from column im-1</span>
<span class="n">dx</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">dx_tmp</span><span class="p">[:,:]</span>
<span class="n">dx</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">dx_tmp</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="c1"># same for dy</span>
<span class="n">dy</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">dy_tmp</span><span class="p">[:,:]</span>
<span class="n">dy</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">dy_tmp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span>
<span class="n">area</span> <span class="o">=</span> <span class="n">dx</span> <span class="o">*</span> <span class="n">dy</span>    <span class="c1"># in m^2</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">depth_tmp</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">depth</span><span class="o">.</span><span class="n">data</span>
<span class="n">depth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">depth_tmp</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">interface</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">depth_tmp</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">depth</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">depth_tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">depth_tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">::])</span>
<span class="n">depth</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">6000.</span>
<span class="n">dz</span> <span class="o">=</span> <span class="n">depth</span><span class="p">[</span><span class="mi">1</span><span class="p">::]</span> <span class="o">-</span> <span class="n">depth</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dz</span><span class="p">)):</span>
    <span class="n">interface</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">interface</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">dz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">interface</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0.00000000e+00, 1.03080750e+00, 2.11176848e+00, 3.26198101e+00,
       4.49832058e+00, 5.84169769e+00, 7.31777668e+00, 8.95763397e+00,
       1.07982149e+01, 1.28823605e+01, 1.52581806e+01, 1.79775600e+01,
       2.10937099e+01, 2.46579590e+01, 2.87164307e+01, 3.33073807e+01,
       3.84601097e+01, 4.41959534e+01, 5.05312653e+01, 5.74817390e+01,
       6.50672607e+01, 7.33164215e+01, 8.22702942e+01, 9.19853668e+01,
       1.02535805e+02, 1.14015152e+02, 1.26537903e+02, 1.40240997e+02,
       1.55285355e+02, 1.71857208e+02, 1.90169952e+02, 2.10465607e+02,
       2.33015900e+02, 2.58123505e+02, 2.86121948e+02, 3.17375153e+02,
       3.52275635e+02, 3.91241211e+02, 4.34709778e+02, 4.83132751e+02,
       5.36966064e+02, 5.96659180e+02, 6.62642334e+02, 7.35313477e+02,
       8.15023682e+02, 9.02063477e+02, 9.96650940e+02, 1.09892249e+03,
       1.20892603e+03, 1.32661890e+03, 1.45187048e+03, 1.58446606e+03,
       1.72411951e+03, 1.87048352e+03, 2.02316162e+03, 2.18172461e+03,
       2.34572363e+03, 2.51470239e+03, 2.68820947e+03, 2.86580469e+03,
       3.04706738e+03, 3.23160303e+03, 3.41904346e+03, 3.60905151e+03,
       3.80131934e+03, 3.99557031e+03, 4.19155615e+03, 4.38905371e+03,
       4.58786816e+03, 4.78782520e+03, 4.98877441e+03, 5.19058105e+03,
       5.39312891e+03, 5.59631836e+03, 5.80005957e+03, 6.00000000e+03])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create dataset with grid info</span>
<span class="n">grd</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span>
    <span class="n">data_vars</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">dx</span><span class="o">=</span><span class="p">([</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">],</span> <span class="n">dx</span><span class="p">),</span>
        <span class="n">dy</span><span class="o">=</span><span class="p">([</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">],</span> <span class="n">dy</span><span class="p">),</span>
        <span class="n">area</span><span class="o">=</span><span class="p">([</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">],</span> <span class="n">area</span><span class="p">),</span>
        <span class="n">dz</span><span class="o">=</span><span class="p">([</span><span class="s2">&quot;depth&quot;</span><span class="p">],</span> <span class="n">dz</span><span class="p">),</span>
    <span class="p">),</span>
    <span class="n">coords</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">longitude</span><span class="o">=</span><span class="p">([</span><span class="s2">&quot;longitude&quot;</span><span class="p">],</span> <span class="n">ds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">data</span><span class="p">),</span>
        <span class="n">latitude</span><span class="o">=</span><span class="p">([</span><span class="s2">&quot;latitude&quot;</span><span class="p">],</span> <span class="n">ds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">data</span><span class="p">),</span>
    <span class="p">),</span>
    <span class="n">attrs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Grid info (approximate)&quot;</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">grd</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt;
Dimensions:    (latitude: 681, longitude: 1440, depth: 75)
Coordinates:
  * longitude  (longitude) float32 -180.0 -179.8 -179.5 ... 179.2 179.5 179.8
  * latitude   (latitude) float32 -80.0 -79.75 -79.5 -79.25 ... 89.5 89.75 90.0
Dimensions without coordinates: depth
Data variables:
    dx         (latitude, longitude) float64 4.827e+03 4.827e+03 ... 0.0 0.0
    dy         (latitude, longitude) float64 2.78e+04 2.78e+04 ... 2.78e+04
    area       (latitude, longitude) float64 1.342e+08 1.342e+08 ... 0.0 0.0
    dz         (depth) float64 1.031 1.081 1.15 1.236 ... 203.2 203.7 199.9
Attributes:
    description:  Grid info (approximate)</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-ddfaae07-13cb-4708-bb6a-e821ed8dd0f6' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-ddfaae07-13cb-4708-bb6a-e821ed8dd0f6' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>latitude</span>: 681</li><li><span class='xr-has-index'>longitude</span>: 1440</li><li><span>depth</span>: 75</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-8ee09da9-9718-4304-87c4-7b4bd5f96a98' class='xr-section-summary-in' type='checkbox'  checked><label for='section-8ee09da9-9718-4304-87c4-7b4bd5f96a98' class='xr-section-summary' >Coordinates: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>longitude</span></div><div class='xr-var-dims'>(longitude)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>-180.0 -179.8 ... 179.5 179.8</div><input id='attrs-ef745104-247b-4352-8952-c57b15479c4c' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-ef745104-247b-4352-8952-c57b15479c4c' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-672a02b3-f465-4ec3-b3cb-1ebc57a864a8' class='xr-var-data-in' type='checkbox'><label for='data-672a02b3-f465-4ec3-b3cb-1ebc57a864a8' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([-180.  , -179.75, -179.5 , ...,  179.25,  179.5 ,  179.75],
      dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>latitude</span></div><div class='xr-var-dims'>(latitude)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>-80.0 -79.75 -79.5 ... 89.75 90.0</div><input id='attrs-2ffc8dbb-cb8d-4c95-bf14-0969a09f5e1c' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-2ffc8dbb-cb8d-4c95-bf14-0969a09f5e1c' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-56f77c70-b32c-496e-9d15-7c496b23601e' class='xr-var-data-in' type='checkbox'><label for='data-56f77c70-b32c-496e-9d15-7c496b23601e' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([-80.  , -79.75, -79.5 , ...,  89.5 ,  89.75,  90.  ], dtype=float32)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-c82ad9f7-d548-45c3-8460-b82ed6741c78' class='xr-section-summary-in' type='checkbox'  checked><label for='section-c82ad9f7-d548-45c3-8460-b82ed6741c78' class='xr-section-summary' >Data variables: <span>(4)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>dx</span></div><div class='xr-var-dims'>(latitude, longitude)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>4.827e+03 4.827e+03 ... 0.0 0.0</div><input id='attrs-c6dfd363-8780-458d-ad6c-4dcecdce064e' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-c6dfd363-8780-458d-ad6c-4dcecdce064e' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-3f13bd57-2336-4b50-86c7-7c7bdad01129' class='xr-var-data-in' type='checkbox'><label for='data-3f13bd57-2336-4b50-86c7-7c7bdad01129' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[4827.19310754, 4827.19310754, 4827.19310754, ..., 4827.19310754,
        4827.19310754, 4827.19310754],
       [4946.59874242, 4946.59874242, 4946.59874242, ..., 4946.59874242,
        4946.59874242, 4946.59874242],
       [5065.91020162, 5065.91020162, 5065.91020162, ..., 5065.91020162,
        5065.91020162, 5065.91020162],
       ...,
       [ 242.586312  ,  242.586312  ,  242.586312  , ...,  242.586312  ,
         242.586312  ,  242.586312  ],
       [ 121.29431063,  121.29431063,  121.29431063, ...,  121.29431063,
         121.29431063,  121.29431063],
       [   0.        ,    0.        ,    0.        , ...,    0.        ,
           0.        ,    0.        ]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>dy</span></div><div class='xr-var-dims'>(latitude, longitude)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>2.78e+04 2.78e+04 ... 2.78e+04</div><input id='attrs-1dd23fcc-03fb-4a09-a552-a8ec0c364fac' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-1dd23fcc-03fb-4a09-a552-a8ec0c364fac' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-a7b931b5-a299-4005-8476-affa2a5af6b7' class='xr-var-data-in' type='checkbox'><label for='data-a7b931b5-a299-4005-8476-affa2a5af6b7' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[27798.71857117, 27798.71857117, 27798.71857117, ...,
        27798.71857117, 27798.71857117, 27798.71857117],
       [27798.71857117, 27798.71857117, 27798.71857117, ...,
        27798.71857117, 27798.71857117, 27798.71857117],
       [27798.71857117, 27798.71857117, 27798.71857117, ...,
        27798.71857117, 27798.71857117, 27798.71857117],
       ...,
       [27798.71857117, 27798.71857117, 27798.71857117, ...,
        27798.71857117, 27798.71857117, 27798.71857117],
       [27798.71857117, 27798.71857117, 27798.71857117, ...,
        27798.71857117, 27798.71857117, 27798.71857117],
       [27798.71857117, 27798.71857117, 27798.71857117, ...,
        27798.71857117, 27798.71857117, 27798.71857117]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>area</span></div><div class='xr-var-dims'>(latitude, longitude)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>1.342e+08 1.342e+08 ... 0.0 0.0</div><input id='attrs-c403ebbf-d653-4f47-b960-09e272fa640b' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-c403ebbf-d653-4f47-b960-09e272fa640b' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-ac715111-aa9c-4feb-96e6-152e0f641e33' class='xr-var-data-in' type='checkbox'><label for='data-ac715111-aa9c-4feb-96e6-152e0f641e33' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[1.34189783e+08, 1.34189783e+08, 1.34189783e+08, ...,
        1.34189783e+08, 1.34189783e+08, 1.34189783e+08],
       [1.37509106e+08, 1.37509106e+08, 1.37509106e+08, ...,
        1.37509106e+08, 1.37509106e+08, 1.37509106e+08],
       [1.40825812e+08, 1.40825812e+08, 1.40825812e+08, ...,
        1.40825812e+08, 1.40825812e+08, 1.40825812e+08],
       ...,
       [6.74358862e+06, 6.74358862e+06, 6.74358862e+06, ...,
        6.74358862e+06, 6.74358862e+06, 6.74358862e+06],
       [3.37182641e+06, 3.37182641e+06, 3.37182641e+06, ...,
        3.37182641e+06, 3.37182641e+06, 3.37182641e+06],
       [0.00000000e+00, 0.00000000e+00, 0.00000000e+00, ...,
        0.00000000e+00, 0.00000000e+00, 0.00000000e+00]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>dz</span></div><div class='xr-var-dims'>(depth)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>1.031 1.081 1.15 ... 203.7 199.9</div><input id='attrs-36093557-fdc1-496c-a7fe-ae8bb5d79ed8' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-36093557-fdc1-496c-a7fe-ae8bb5d79ed8' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-7a5e7402-d8a8-4c57-977a-91dfa646e329' class='xr-var-data-in' type='checkbox'><label for='data-7a5e7402-d8a8-4c57-977a-91dfa646e329' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([  1.0308075 ,   1.08096099,   1.15021253,   1.23633957,
         1.34337711,   1.47607899,   1.63985729,   1.84058094,
         2.08414555,   2.37582016,   2.71937943,   3.1161499 ,
         3.56424904,   4.05847168,   4.59095001,   5.15272903,
         5.73584366,   6.33531189,   6.95047379,   7.5855217 ,
         8.24916077,   8.95387268,   9.71507263,  10.55043793,
        11.47934723,  12.52275085,  13.70309448,  15.0443573 ,
        16.57185364,  18.31274414,  20.2956543 ,  22.55029297,
        25.10760498,  27.9984436 ,  31.25320435,  34.90048218,
        38.96557617,  43.46856689,  48.42297363,  53.83331299,
        59.69311523,  65.9831543 ,  72.67114258,  79.71020508,
        87.03979492,  94.58746338, 102.27154541, 110.00354004,
       117.69287109, 125.25158691, 132.59558105, 139.65344238,
       146.36401367, 152.67810059, 158.56298828, 163.99902344,
       168.97875977, 173.50708008, 177.59521484, 181.26269531,
       184.53564453, 187.44042969, 190.00805664, 192.26782227,
       194.25097656, 195.98583984, 197.49755859, 198.81445312,
       199.95703125, 200.94921875, 201.80664062, 202.54785156,
       203.18945312, 203.74121094, 199.94042969])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-fefb3579-1be1-4a1c-87e4-3c28240b01f4' class='xr-section-summary-in' type='checkbox'  checked><label for='section-fefb3579-1be1-4a1c-87e4-3c28240b01f4' class='xr-section-summary' >Attributes: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'><dt><span>description :</span></dt><dd>Grid info (approximate)</dd></dl></div></li></ul></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">basin_code</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.QuadMesh at 0x2ac0907c6190&gt;
</pre></div>
</div>
<img alt="_images/glorys2v2_moc_14_1.png" src="_images/glorys2v2_moc_14_1.png" />
</div>
</div>
</section>
<section id="generate-basin-masks">
<h1>Generate basin masks<a class="headerlink" href="#generate-basin-masks" title="Permalink to this headline">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># basin masks </span>
<span class="n">tmp</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,:]</span><span class="o">.</span><span class="n">values</span>
<span class="n">topo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">tmp</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">*</span> <span class="mf">10.</span>
<span class="c1"># remove Nan&#39;s, otherwise genBasinMasks won&#39;t work</span>
<span class="n">topo</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">tmp</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">geolon</span><span class="p">,</span> <span class="n">geolat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">longitude</span><span class="p">,</span> <span class="n">ds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">latitude</span><span class="p">)</span>
<span class="n">basin_code</span> <span class="o">=</span> <span class="n">genBasinMasks</span><span class="p">(</span><span class="n">geolon</span><span class="p">,</span> <span class="n">geolat</span><span class="p">,</span> <span class="n">topo</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">xda</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generating global wet mask...
done.
Finding Cape of Good Hope ...
done. -34.75
Finding Melbourne ...
done. -0.0
Processing Persian Gulf ...
Processing Red Sea ...
Processing Black Sea ...
Processing Mediterranean ...
Processing Baltic ...
Processing Hudson Bay ...
Processing Arctic ...
Processing Pacific ...
Processing Atlantic ...
Processing Indian ...
Processing Southern Ocean ...
There are leftover points unassigned to a basin code
-53.25 68.0 [592, 507]
-53.0 68.0 [592, 508]
Processing Labrador Sea ...
Processing Baffin Bay ...

  Basin codes:
  -----------------------------------------------------------
  (0) Global              (7) Black Sea
  (1) Southern Ocean      (8) Hudson Bay
  (2) Atlantic Ocean      (9) Baltic Sea
  (3) Pacific Ocean       (10) Red Sea
  (4) Arctic Ocean        (11) Persian Gulf
  (5) Indian Ocean        (12) Lab Sea
  (6) Mediterranean Sea   (13) Baffin Bay

  Important: basin codes overlap. Code 12 and 13 are only loaded if xda=True.

    
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## uncomment this to see all region masks</span>
<span class="c1">#vals = np.unique(basin_code)</span>
<span class="c1">#for v in vals:</span>
<span class="c1">#    dummy = np.zeros(basin_code.shape)</span>
<span class="c1">#    dummy[basin_code == v] = v</span>
<span class="c1">#    dummy = np.ma.masked_where(topo == 0., dummy)</span>
<span class="c1">#    plt.figure(figsize=(12,8))</span>
<span class="c1">#    xyplot(dummy, geolon, geolat,title=&#39;Code = &#39;+str(v))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">topo</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.QuadMesh at 0x2ac092979a60&gt;
</pre></div>
</div>
<img alt="_images/glorys2v2_moc_18_1.png" src="_images/glorys2v2_moc_18_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">basin_code</span> <span class="o">=</span> <span class="n">basin_code</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;xh&#39;</span><span class="p">:</span><span class="s1">&#39;longitude&#39;</span><span class="p">,</span> <span class="s1">&#39;yh&#39;</span><span class="p">:</span><span class="s1">&#39;latitude&#39;</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">basin_code</span><span class="o">.</span><span class="n">region</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray &#x27;region&#x27; (region: 14)&gt;
array([&#x27;Global&#x27;, &#x27;PersianGulf&#x27;, &#x27;RedSea&#x27;, &#x27;BlackSea&#x27;, &#x27;MedSea&#x27;, &#x27;BalticSea&#x27;,
       &#x27;HudsonBay&#x27;, &#x27;Arctic&#x27;, &#x27;PacificOcean&#x27;, &#x27;AtlanticOcean&#x27;, &#x27;IndianOcean&#x27;,
       &#x27;SouthernOcean&#x27;, &#x27;LabSea&#x27;, &#x27;BaffinBay&#x27;], dtype=&#x27;&lt;U13&#x27;)
Coordinates:
  * region   (region) &lt;U13 &#x27;Global&#x27; &#x27;PersianGulf&#x27; ... &#x27;LabSea&#x27; &#x27;BaffinBay&#x27;</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'>'region'</div><ul class='xr-dim-list'><li><span class='xr-has-index'>region</span>: 14</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-a7a431e5-2546-4f8d-9d39-a80dc282ce30' class='xr-array-in' type='checkbox' checked><label for='section-a7a431e5-2546-4f8d-9d39-a80dc282ce30' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>&#x27;Global&#x27; &#x27;PersianGulf&#x27; &#x27;RedSea&#x27; ... &#x27;LabSea&#x27; &#x27;BaffinBay&#x27;</span></div><div class='xr-array-data'><pre>array([&#x27;Global&#x27;, &#x27;PersianGulf&#x27;, &#x27;RedSea&#x27;, &#x27;BlackSea&#x27;, &#x27;MedSea&#x27;, &#x27;BalticSea&#x27;,
       &#x27;HudsonBay&#x27;, &#x27;Arctic&#x27;, &#x27;PacificOcean&#x27;, &#x27;AtlanticOcean&#x27;, &#x27;IndianOcean&#x27;,
       &#x27;SouthernOcean&#x27;, &#x27;LabSea&#x27;, &#x27;BaffinBay&#x27;], dtype=&#x27;&lt;U13&#x27;)</pre></div></div></li><li class='xr-section-item'><input id='section-512d0d95-fbb1-4e3f-8a76-3b8aa00ce978' class='xr-section-summary-in' type='checkbox'  checked><label for='section-512d0d95-fbb1-4e3f-8a76-3b8aa00ce978' class='xr-section-summary' >Coordinates: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>region</span></div><div class='xr-var-dims'>(region)</div><div class='xr-var-dtype'>&lt;U13</div><div class='xr-var-preview xr-preview'>&#x27;Global&#x27; ... &#x27;BaffinBay&#x27;</div><input id='attrs-3e60ea2f-d234-4c1c-80a8-5521f0f6ffd5' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-3e60ea2f-d234-4c1c-80a8-5521f0f6ffd5' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-26dd8eb8-9f49-48d7-9f51-591641fb434f' class='xr-var-data-in' type='checkbox'><label for='data-26dd8eb8-9f49-48d7-9f51-591641fb434f' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;Global&#x27;, &#x27;PersianGulf&#x27;, &#x27;RedSea&#x27;, &#x27;BlackSea&#x27;, &#x27;MedSea&#x27;, &#x27;BalticSea&#x27;,
       &#x27;HudsonBay&#x27;, &#x27;Arctic&#x27;, &#x27;PacificOcean&#x27;, &#x27;AtlanticOcean&#x27;, &#x27;IndianOcean&#x27;,
       &#x27;SouthernOcean&#x27;, &#x27;LabSea&#x27;, &#x27;BaffinBay&#x27;], dtype=&#x27;&lt;U13&#x27;)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-0e20e460-d2b8-4db5-bc7e-8570b4bdb470' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-0e20e460-d2b8-4db5-bc7e-8570b4bdb470' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#m = 0*basin_code; m[(basin_code==2) | (basin_code==4) | (basin_code==6) | (basin_code==7) | (basin_code==8)]=1</span>
<span class="n">atl_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">basin_code</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">region</span><span class="o">=</span><span class="s1">&#39;HudsonBay&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">basin_code</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">region</span><span class="o">=</span><span class="s1">&#39;Arctic&#39;</span><span class="p">)</span> <span class="o">+</span> \
           <span class="n">basin_code</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">region</span><span class="o">=</span><span class="s1">&#39;BlackSea&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">basin_code</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">region</span><span class="o">=</span><span class="s1">&#39;MedSea&#39;</span><span class="p">)</span> <span class="o">+</span> \
           <span class="n">basin_code</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">region</span><span class="o">=</span><span class="s1">&#39;AtlanticOcean&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;atl_mask&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">atl_mask</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.QuadMesh at 0x2ac091f57be0&gt;
</pre></div>
</div>
<img alt="_images/glorys2v2_moc_22_1.png" src="_images/glorys2v2_moc_22_1.png" />
</div>
</div>
</section>
<section id="volume-fluxes-and-moc">
<h1>3. Volume fluxes and MOC<a class="headerlink" href="#volume-fluxes-and-moc" title="Permalink to this headline">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dxdz</span> <span class="o">=</span> <span class="n">grd</span><span class="p">[</span><span class="s1">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">grd</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">]</span>
<span class="p">(</span><span class="n">dxdz</span><span class="p">[</span><span class="mi">60</span><span class="p">,:]</span><span class="o">*</span><span class="n">atl_mask</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.QuadMesh at 0x2ac0920440a0&gt;
</pre></div>
</div>
<img alt="_images/glorys2v2_moc_24_1.png" src="_images/glorys2v2_moc_24_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># add mean vo</span>
<span class="n">vo_mean</span> <span class="o">=</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span>  <span class="n">ds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span>  <span class="n">ds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span>  <span class="n">ds</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
<span class="n">vo_mean</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray (time: 314, depth: 75, latitude: 681, longitude: 1440)&gt;
dask.array&lt;mul, shape=(314, 75, 681, 1440), dtype=float32, chunksize=(1, 75, 681, 1440), chunktype=numpy.ndarray&gt;
Coordinates:
  * time       (time) datetime64[ns] 1993-06-14T12:00:00 ... 2020-12-16
  * depth      (depth) float32 0.5058 1.556 2.668 ... 5.698e+03 5.902e+03
  * latitude   (latitude) float32 -80.0 -79.75 -79.5 -79.25 ... 89.5 89.75 90.0
  * longitude  (longitude) float32 -180.0 -179.8 -179.5 ... 179.2 179.5 179.8</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'></div><ul class='xr-dim-list'><li><span class='xr-has-index'>time</span>: 314</li><li><span class='xr-has-index'>depth</span>: 75</li><li><span class='xr-has-index'>latitude</span>: 681</li><li><span class='xr-has-index'>longitude</span>: 1440</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-bcff6884-4bba-4f84-8462-49a225c1f926' class='xr-array-in' type='checkbox' checked><label for='section-bcff6884-4bba-4f84-8462-49a225c1f926' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>dask.array&lt;chunksize=(1, 75, 681, 1440), meta=np.ndarray&gt;</span></div><div class='xr-array-data'><table>
    <tr>
        <td>
            <table>
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>

                    <tr>
                        <th> Bytes </th>
                        <td> 86.03 GiB </td>
                        <td> 280.56 MiB </td>
                    </tr>

                    <tr>
                        <th> Shape </th>
                        <td> (314, 75, 681, 1440) </td>
                        <td> (1, 75, 681, 1440) </td>
                    </tr>
                    <tr>
                        <th> Count </th>
                        <td> 7139 Tasks </td>
                        <td> 314 Chunks </td>
                    </tr>
                    <tr>
                    <th> Type </th>
                    <td> float32 </td>
                    <td> numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="414" height="127" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="0" y1="0" x2="42" y2="0" style="stroke-width:2" />
  <line x1="0" y1="25" x2="42" y2="25" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="0" y1="0" x2="0" y2="25" style="stroke-width:2" />
  <line x1="1" y1="0" x2="1" y2="25" />
  <line x1="2" y1="0" x2="2" y2="25" />
  <line x1="3" y1="0" x2="3" y2="25" />
  <line x1="5" y1="0" x2="5" y2="25" />
  <line x1="6" y1="0" x2="6" y2="25" />
  <line x1="7" y1="0" x2="7" y2="25" />
  <line x1="9" y1="0" x2="9" y2="25" />
  <line x1="10" y1="0" x2="10" y2="25" />
  <line x1="11" y1="0" x2="11" y2="25" />
  <line x1="13" y1="0" x2="13" y2="25" />
  <line x1="14" y1="0" x2="14" y2="25" />
  <line x1="15" y1="0" x2="15" y2="25" />
  <line x1="17" y1="0" x2="17" y2="25" />
  <line x1="18" y1="0" x2="18" y2="25" />
  <line x1="19" y1="0" x2="19" y2="25" />
  <line x1="21" y1="0" x2="21" y2="25" />
  <line x1="22" y1="0" x2="22" y2="25" />
  <line x1="23" y1="0" x2="23" y2="25" />
  <line x1="25" y1="0" x2="25" y2="25" />
  <line x1="26" y1="0" x2="26" y2="25" />
  <line x1="27" y1="0" x2="27" y2="25" />
  <line x1="29" y1="0" x2="29" y2="25" />
  <line x1="30" y1="0" x2="30" y2="25" />
  <line x1="31" y1="0" x2="31" y2="25" />
  <line x1="33" y1="0" x2="33" y2="25" />
  <line x1="34" y1="0" x2="34" y2="25" />
  <line x1="35" y1="0" x2="35" y2="25" />
  <line x1="36" y1="0" x2="36" y2="25" />
  <line x1="38" y1="0" x2="38" y2="25" />
  <line x1="39" y1="0" x2="39" y2="25" />
  <line x1="41" y1="0" x2="41" y2="25" />
  <line x1="42" y1="0" x2="42" y2="25" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="0.0,0.0 42.367065976524714,0.0 42.367065976524714,25.412616514582485 0.0,25.412616514582485" style="fill:#8B4903A0;stroke-width:0"/>

  <!-- Text -->
  <text x="21.183533" y="45.412617" font-size="1.0rem" font-weight="100" text-anchor="middle" >314</text>
  <text x="62.367066" y="12.706308" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(0,62.367066,12.706308)">1</text>


  <!-- Horizontal lines -->
  <line x1="112" y1="0" x2="132" y2="20" style="stroke-width:2" />
  <line x1="112" y1="56" x2="132" y2="77" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="112" y1="0" x2="112" y2="56" style="stroke-width:2" />
  <line x1="132" y1="20" x2="132" y2="77" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="112.0,0.0 132.44165174910967,20.441651749109663 132.44165174910967,77.19165174910967 112.0,56.75" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="112" y1="0" x2="232" y2="0" style="stroke-width:2" />
  <line x1="132" y1="20" x2="252" y2="20" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="112" y1="0" x2="132" y2="20" style="stroke-width:2" />
  <line x1="232" y1="0" x2="252" y2="20" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="112.0,0.0 232.0,0.0 252.44165174910967,20.441651749109663 132.44165174910967,20.441651749109663" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="132" y1="20" x2="252" y2="20" style="stroke-width:2" />
  <line x1="132" y1="77" x2="252" y2="77" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="132" y1="20" x2="132" y2="77" style="stroke-width:2" />
  <line x1="252" y1="20" x2="252" y2="77" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="132.44165174910967,20.441651749109663 252.44165174910967,20.441651749109663 252.44165174910967,77.19165174910967 132.44165174910967,77.19165174910967" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="192.441652" y="97.191652" font-size="1.0rem" font-weight="100" text-anchor="middle" >1440</text>
  <text x="272.441652" y="48.816652" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,272.441652,48.816652)">681</text>
  <text x="112.220826" y="86.970826" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(45,112.220826,86.970826)">75</text>
</svg>
        </td>
    </tr>
</table></div></div></li><li class='xr-section-item'><input id='section-252fc9af-fcca-4908-823e-c397a48d306c' class='xr-section-summary-in' type='checkbox'  checked><label for='section-252fc9af-fcca-4908-823e-c397a48d306c' class='xr-section-summary' >Coordinates: <span>(4)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>time</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>datetime64[ns]</div><div class='xr-var-preview xr-preview'>1993-06-14T12:00:00 ... 2020-12-16</div><input id='attrs-46bf08ca-9521-4fff-be65-8c9dc04b8e0d' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-46bf08ca-9521-4fff-be65-8c9dc04b8e0d' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-cff4b5bd-8c37-4ca3-a0ae-159a234b439a' class='xr-var-data-in' type='checkbox'><label for='data-cff4b5bd-8c37-4ca3-a0ae-159a234b439a' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>axis :</span></dt><dd>T</dd><dt><span>long_name :</span></dt><dd>Time</dd><dt><span>standard_name :</span></dt><dd>time</dd><dt><span>cell_methods :</span></dt><dd>time: mean</dd><dt><span>_ChunkSizes :</span></dt><dd>1024</dd><dt><span>_CoordinateAxisType :</span></dt><dd>Time</dd><dt><span>valid_min :</span></dt><dd>15721.0</dd><dt><span>valid_max :</span></dt><dd>15721.0</dd></dl></div><div class='xr-var-data'><pre>array([&#x27;1993-06-14T12:00:00.000000000&#x27;, &#x27;1993-10-16T00:00:00.000000000&#x27;,
       &#x27;1993-11-15T12:00:00.000000000&#x27;, ..., &#x27;2020-10-16T00:00:00.000000000&#x27;,
       &#x27;2020-11-15T12:00:00.000000000&#x27;, &#x27;2020-12-16T00:00:00.000000000&#x27;],
      dtype=&#x27;datetime64[ns]&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>depth</span></div><div class='xr-var-dims'>(depth)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>0.5058 1.556 ... 5.902e+03</div><input id='attrs-5a402479-e307-4d2e-afae-ee5ba2fdf6bd' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-5a402479-e307-4d2e-afae-ee5ba2fdf6bd' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-d10676c8-4e15-46ea-826f-7c39fa64d804' class='xr-var-data-in' type='checkbox'><label for='data-d10676c8-4e15-46ea-826f-7c39fa64d804' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>valid_min :</span></dt><dd>0.50576</dd><dt><span>valid_max :</span></dt><dd>5902.058</dd><dt><span>units :</span></dt><dd>m</dd><dt><span>positive :</span></dt><dd>down</dd><dt><span>unit_long :</span></dt><dd>Meters</dd><dt><span>long_name :</span></dt><dd>Depth</dd><dt><span>standard_name :</span></dt><dd>depth</dd><dt><span>axis :</span></dt><dd>Z</dd><dt><span>_ChunkSizes :</span></dt><dd>75</dd><dt><span>_CoordinateAxisType :</span></dt><dd>Height</dd><dt><span>_CoordinateZisPositive :</span></dt><dd>down</dd></dl></div><div class='xr-var-data'><pre>array([5.057600e-01, 1.555855e+00, 2.667682e+00, 3.856280e+00, 5.140361e+00,
       6.543034e+00, 8.092519e+00, 9.822750e+00, 1.177368e+01, 1.399104e+01,
       1.652532e+01, 1.942980e+01, 2.275762e+01, 2.655830e+01, 3.087456e+01,
       3.574020e+01, 4.118002e+01, 4.721189e+01, 5.385064e+01, 6.111284e+01,
       6.902168e+01, 7.761116e+01, 8.692943e+01, 9.704131e+01, 1.080303e+02,
       1.200000e+02, 1.330758e+02, 1.474062e+02, 1.631645e+02, 1.805499e+02,
       1.997900e+02, 2.211412e+02, 2.448906e+02, 2.713564e+02, 3.008875e+02,
       3.338628e+02, 3.706885e+02, 4.117939e+02, 4.576256e+02, 5.086399e+02,
       5.652923e+02, 6.280260e+02, 6.972587e+02, 7.733683e+02, 8.566790e+02,
       9.474479e+02, 1.045854e+03, 1.151991e+03, 1.265861e+03, 1.387377e+03,
       1.516364e+03, 1.652568e+03, 1.795671e+03, 1.945296e+03, 2.101027e+03,
       2.262422e+03, 2.429025e+03, 2.600380e+03, 2.776039e+03, 2.955570e+03,
       3.138565e+03, 3.324641e+03, 3.513446e+03, 3.704657e+03, 3.897982e+03,
       4.093159e+03, 4.289953e+03, 4.488155e+03, 4.687581e+03, 4.888070e+03,
       5.089479e+03, 5.291683e+03, 5.494575e+03, 5.698061e+03, 5.902058e+03],
      dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>latitude</span></div><div class='xr-var-dims'>(latitude)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>-80.0 -79.75 -79.5 ... 89.75 90.0</div><input id='attrs-6ef00875-c346-4a81-af22-5ea85cbabe4d' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-6ef00875-c346-4a81-af22-5ea85cbabe4d' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-91043bc9-3918-481d-95fe-c3ddf1aed72d' class='xr-var-data-in' type='checkbox'><label for='data-91043bc9-3918-481d-95fe-c3ddf1aed72d' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>valid_min :</span></dt><dd>-80.0</dd><dt><span>valid_max :</span></dt><dd>90.0</dd><dt><span>step :</span></dt><dd>0.25</dd><dt><span>units :</span></dt><dd>degrees_north</dd><dt><span>unit_long :</span></dt><dd>Degrees North</dd><dt><span>long_name :</span></dt><dd>Latitude</dd><dt><span>standard_name :</span></dt><dd>latitude</dd><dt><span>axis :</span></dt><dd>Y</dd><dt><span>_ChunkSizes :</span></dt><dd>681</dd><dt><span>_CoordinateAxisType :</span></dt><dd>Lat</dd></dl></div><div class='xr-var-data'><pre>array([-80.  , -79.75, -79.5 , ...,  89.5 ,  89.75,  90.  ], dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>longitude</span></div><div class='xr-var-dims'>(longitude)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>-180.0 -179.8 ... 179.5 179.8</div><input id='attrs-1153a1a7-2dfd-438a-bb61-6276b1ada4ca' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-1153a1a7-2dfd-438a-bb61-6276b1ada4ca' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-2d0e31b4-7a23-445c-9e79-c500814174c5' class='xr-var-data-in' type='checkbox'><label for='data-2d0e31b4-7a23-445c-9e79-c500814174c5' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>valid_min :</span></dt><dd>-180.0</dd><dt><span>valid_max :</span></dt><dd>179.75</dd><dt><span>step :</span></dt><dd>0.25</dd><dt><span>units :</span></dt><dd>degrees_east</dd><dt><span>unit_long :</span></dt><dd>Degrees East</dd><dt><span>long_name :</span></dt><dd>Longitude</dd><dt><span>standard_name :</span></dt><dd>longitude</dd><dt><span>axis :</span></dt><dd>X</dd><dt><span>_ChunkSizes :</span></dt><dd>1440</dd><dt><span>_CoordinateAxisType :</span></dt><dd>Lon</dd></dl></div><div class='xr-var-data'><pre>array([-180.  , -179.75, -179.5 , ...,  179.25,  179.5 ,  179.75],
      dtype=float32)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-0132a2a2-83b0-437a-b114-b8d5591696d0' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-0132a2a2-83b0-437a-b114-b8d5591696d0' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># grid-oriented volume fluxes in Sv</span>
<span class="n">vflux</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">models</span><span class="p">)):</span>
  <span class="n">vo</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
  <span class="n">vflux</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vo</span><span class="o">*</span><span class="n">dxdz</span><span class="o">/</span><span class="mf">1.e6</span><span class="p">)</span>

<span class="n">vflux</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vo_mean</span><span class="o">*</span><span class="n">dxdz</span><span class="o">/</span><span class="mf">1.e6</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plotting function</span>
<span class="k">def</span> <span class="nf">plot_moc</span><span class="p">(</span><span class="n">psi</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">cmax</span><span class="o">=</span><span class="mf">40.</span><span class="p">):</span>
  <span class="n">m6plot</span><span class="o">.</span><span class="n">setFigureSize</span><span class="p">([</span><span class="mi">16</span><span class="p">,</span><span class="mi">9</span><span class="p">],</span><span class="mi">576</span><span class="p">)</span>
  <span class="n">axis</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
  <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;dunnePM&#39;</span><span class="p">)</span>
  <span class="n">y</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">values</span>
  <span class="n">ci</span><span class="o">=</span><span class="n">m6plot</span><span class="o">.</span><span class="n">pmCI</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="n">cmax</span><span class="p">,</span><span class="mf">5.</span><span class="p">)</span>
  <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;dunnePM&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">psi</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">ci</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">extend</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">)</span>
  <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">psi</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">ci</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
  <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;[Sv]&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Elevation [m]&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
  <span class="k">return</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="moc">
<h1>MOC<a class="headerlink" href="#moc" title="Permalink to this headline">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">moc</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">models</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;glor&#39;</span><span class="p">,</span><span class="s1">&#39;foam&#39;</span><span class="p">,</span><span class="s1">&#39;cglo&#39;</span><span class="p">,</span><span class="s1">&#39;oras&#39;</span><span class="p">,</span> <span class="s1">&#39;all_models&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">models</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">models</span><span class="p">))):</span>
  <span class="n">zonalsum</span> <span class="o">=</span> <span class="p">(</span><span class="n">vflux</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;longitude&#39;</span><span class="p">})</span>
  <span class="n">vertcsum</span> <span class="o">=</span> <span class="n">zonalsum</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;depth&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="n">zonalsum</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;depth&#39;</span><span class="p">)</span>
  <span class="c1"># the result of the integration over layers is evaluated at the interfaces</span>
  <span class="c1"># with psi = 0 as the bottom boundary condition for the integration</span>
  <span class="n">bottom_condition</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">vertcsum</span><span class="o">.</span><span class="n">isel</span><span class="p">({</span><span class="s1">&#39;depth&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">}))</span>
  <span class="n">moc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">vertcsum</span><span class="p">,</span> <span class="n">bottom_condition</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;depth&#39;</span><span class="p">))</span>
  <span class="n">moc</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;depth&#39;</span><span class="p">][:]</span> <span class="o">=</span> <span class="n">interface</span>
  <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_moc.nc&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
  <span class="n">moc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;moc&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span> <span class="o">=</span> <span class="n">interface</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">values</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">moc</span><span class="p">)),</span> <span class="n">models</span><span class="p">):</span>
  <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Global MOC, </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
  <span class="n">plot_moc</span><span class="p">(</span><span class="n">moc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">compute</span><span class="p">(),</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">cmax</span><span class="o">=</span><span class="mf">50.</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/glorys2v2_moc_30_0.png" src="_images/glorys2v2_moc_30_0.png" />
<img alt="_images/glorys2v2_moc_30_1.png" src="_images/glorys2v2_moc_30_1.png" />
<img alt="_images/glorys2v2_moc_30_2.png" src="_images/glorys2v2_moc_30_2.png" />
<img alt="_images/glorys2v2_moc_30_3.png" src="_images/glorys2v2_moc_30_3.png" />
<img alt="_images/glorys2v2_moc_30_4.png" src="_images/glorys2v2_moc_30_4.png" />
</div>
</div>
</section>
<section id="amoc">
<h1>AMOC<a class="headerlink" href="#amoc" title="Permalink to this headline">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">amoc</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">models</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">models</span><span class="p">))):</span>
  <span class="n">zonalsum</span> <span class="o">=</span> <span class="p">(</span><span class="n">vflux</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">atl_mask</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;longitude&#39;</span><span class="p">})</span>
  <span class="n">vertcsum</span> <span class="o">=</span> <span class="n">zonalsum</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;depth&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="n">zonalsum</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;depth&#39;</span><span class="p">)</span>
  <span class="c1"># the result of the integration over layers is evaluated at the interfaces</span>
  <span class="c1"># with psi = 0 as the bottom boundary condition for the integration</span>
  <span class="n">bottom_condition</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">vertcsum</span><span class="o">.</span><span class="n">isel</span><span class="p">({</span><span class="s1">&#39;depth&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">}))</span>
  <span class="n">amoc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">vertcsum</span><span class="p">,</span> <span class="n">bottom_condition</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;depth&#39;</span><span class="p">))</span>
  <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_amoc.nc&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
  <span class="n">amoc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;amoc&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">amoc</span><span class="p">)),</span> <span class="n">models</span><span class="p">):</span>
  <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Atlantic MOC, </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
  <span class="n">plot_moc</span><span class="p">(</span><span class="n">amoc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">compute</span><span class="p">(),</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">cmax</span><span class="o">=</span><span class="mf">30.</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/glorys2v2_moc_33_0.png" src="_images/glorys2v2_moc_33_0.png" />
<img alt="_images/glorys2v2_moc_33_1.png" src="_images/glorys2v2_moc_33_1.png" />
<img alt="_images/glorys2v2_moc_33_2.png" src="_images/glorys2v2_moc_33_2.png" />
<img alt="_images/glorys2v2_moc_33_3.png" src="_images/glorys2v2_moc_33_3.png" />
<img alt="_images/glorys2v2_moc_33_4.png" src="_images/glorys2v2_moc_33_4.png" />
</div>
</div>
</section>
<section id="monthly-time-series-of-maximum-transport-at-34-5">
<h1>Monthly time series of maximum transport at -34.5<a class="headerlink" href="#monthly-time-series-of-maximum-transport-at-34-5" title="Permalink to this headline">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">amoc</span><span class="p">)),</span> <span class="n">models</span><span class="p">):</span>
  <span class="n">amoc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">latitude</span><span class="o">=-</span><span class="mf">34.5</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;depth&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">m</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x2ac090001ca0&gt;
</pre></div>
</div>
<img alt="_images/glorys2v2_moc_35_1.png" src="_images/glorys2v2_moc_35_1.png" />
</div>
</div>
</section>
<section id="amoc-depth-profile">
<h1>AMOC depth profile<a class="headerlink" href="#amoc-depth-profile" title="Permalink to this headline">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">amoc</span><span class="p">)),</span> <span class="n">models</span><span class="p">):</span>
  <span class="n">dummy</span> <span class="o">=</span> <span class="n">amoc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">latitude</span><span class="o">=-</span><span class="mf">34.5</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="s2">&quot;2013-01-01&quot;</span><span class="p">,</span>
                                                                      <span class="s2">&quot;2018-01-01&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
  <span class="n">dummy</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;depth&#39;</span><span class="p">,</span> <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">m</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x2ac0913e5dc0&gt;
</pre></div>
</div>
<img alt="_images/glorys2v2_moc_37_1.png" src="_images/glorys2v2_moc_37_1.png" />
</div>
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "conda-env-miniconda-dev2-py"
        },
        kernelOptions: {
            kernelName: "conda-env-miniconda-dev2-py",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'conda-env-miniconda-dev2-py'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="south_atlantic_maks_gx1v7.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Build masks</p>
        </div>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By NCAR ESDS Team<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>